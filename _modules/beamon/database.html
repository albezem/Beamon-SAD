
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>beamon.database &#8212; Beamon SAD alpha documentation</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for beamon.database</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">pandas.io.sql</span> <span class="k">as</span> <span class="nn">sql</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">magic</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>
<span class="kn">from</span> <span class="nn">csv</span> <span class="kn">import</span> <span class="n">writer</span>
<span class="kn">import</span> <span class="nn">beamon.core</span> <span class="k">as</span> <span class="nn">beamcalc</span>

<span class="kn">from</span> <span class="nn">beamon.FileIntegrityError</span> <span class="kn">import</span> <span class="n">FileIntegrityError</span>
<span class="kn">from</span> <span class="nn">beamon</span> <span class="kn">import</span> <span class="n">constants</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">DataFrame</span>


<div class="viewcode-block" id="Database"><a class="viewcode-back" href="../../api.html#beamon.database.Database">[docs]</a><span class="k">class</span> <span class="nc">Database</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A data set to save all the data for constructing Elements in Visualization and for calculations in Beamon</span>
<span class="sd">    **Warning**: This class should follow singleton pattern.</span>

<span class="sd">    Important Attributes</span>
<span class="sd">    --------------------</span>

<span class="sd">    conn: SQLite3 connection object</span>

<span class="sd">    cur: cursor for SQLite queries</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Pandas Dataframes to save simulation results</span>
    <span class="c1"># TODO: change these pandas Dataframes to tables in the database</span>
    <span class="n">local_element_displacements</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">element_stats</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">local_element_section_forces</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">global_element_evaluation_points</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">global_element_displaced_points</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">nodes_results</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">global_displaced_nodes</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">global_element_displacements</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">ram</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">triggers</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path_to_database</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ram</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">path_to_save_database</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initiates a database with initial parameters. Database integrity will be checked upon loading.</span>

<span class="sd">        :param path_to_database: if not given a database name using a timestamp will be generated</span>
<span class="sd">        :type path_to_database: string</span>
<span class="sd">        :param check: Check database integrity. Default value is True</span>
<span class="sd">        :type check: boolean</span>
<span class="sd">        :param ram: Load Database to ram. Default False. If path is valid ram will be discarded.</span>
<span class="sd">        :type ram: boolean</span>
<span class="sd">        :param path_to_save_database: path to new database if a new database should be created</span>
<span class="sd">        :type path_to_save_database: string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">path_to_save_database</span>  <span class="c1"># name of the database to be shown on the window title</span>
        <span class="c1"># if no path is given</span>
        <span class="k">if</span> <span class="n">path_to_database</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># create an empty database</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">make_dummy_file</span><span class="p">(</span><span class="n">ram</span><span class="o">=</span><span class="n">ram</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">path_to_save_database</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># load database from path</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># connect to given database file</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">path_to_database</span><span class="p">,</span> <span class="n">check_same_thread</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="c1"># create a cursor object to execute SQL queries</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
                <span class="n">db_integrity</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">check</span><span class="p">:</span>
                    <span class="n">db_integrity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_database</span><span class="p">()</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">db_integrity</span><span class="p">:</span>
                    <span class="c1"># Database is failed check test</span>
                    <span class="k">raise</span> <span class="n">FileIntegrityError</span><span class="p">(</span>
                        <span class="s2">&quot;Project database failed check test, check given path for the project file&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FileIntegrityError</span><span class="p">(</span><span class="s2">&quot;Project database failed to load. Database error: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
                <span class="c1"># msg = QMessageBox()</span>
                <span class="c1"># msg.setIcon(QMessageBox.Critical)</span>
                <span class="c1"># msg.setText(&quot;Projekt konnte nicht geladen werden&quot;)</span>
                <span class="c1"># msg.setInformativeText(&quot;Ein leeres Projekt wird erstellt&quot;)</span>
                <span class="c1"># msg.setDetailedText(</span>
                <span class="c1">#     &quot;Database error: %s&quot; % e)</span>
                <span class="c1"># msg.setStandardButtons(QMessageBox.Ok)</span>
                <span class="c1"># msg.exec()</span>
                <span class="c1"># db_integrity = False</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FileIntegrityError</span><span class="p">(</span><span class="s2">&quot;Project database failed to load. Exception in query: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
                <span class="c1"># msg = QMessageBox()</span>
                <span class="c1"># msg.setIcon(QMessageBox.Critical)</span>
                <span class="c1"># msg.setText(&quot;Projekt konnte nicht geladen werden&quot;)</span>
                <span class="c1"># msg.setInformativeText(&quot;Ein leeres Projekt wird erstellt&quot;)</span>
                <span class="c1"># msg.setDetailedText(</span>
                <span class="c1">#     &quot;Exception in query: %s&quot; % e)</span>
                <span class="c1"># msg.setStandardButtons(QMessageBox.Ok)</span>
                <span class="c1"># msg.exec()</span>
                <span class="c1"># db_integrity = False</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="c1"># change database name</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">path_to_database</span>
                <span class="c1"># if not db_integrity:</span>
            <span class="c1">#         self.make_dummy_file(ram=ram)</span>
            <span class="c1">#     self.name = path_to_database</span>

        <span class="c1"># self.clear_database()</span>
        <span class="c1"># to make contains calls faster and reduce overhead</span>
        <span class="c1"># self.nodes_indexes = np.empty(1)</span>

<div class="viewcode-block" id="Database.make_dummy_file"><a class="viewcode-back" href="../../api.html#beamon.database.Database.make_dummy_file">[docs]</a>    <span class="k">def</span> <span class="nf">make_dummy_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ram</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new sqlite database according to given settings. This method contains CREATE queries for database</span>
<span class="sd">        tables.</span>

<span class="sd">        :param name: name of the database file. Default name is a string containing a timestamp as follows:</span>
<span class="sd">         Database_dd-mm-yyyy_hh-mm-ss</span>
<span class="sd">        :param ram: default:False. if True the database wil be loaded into the ram and not saved to hard drive</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">-%m-%Y_%H-%M-%S&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;database_&quot;</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">+</span> <span class="s2">&quot;.db&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">if</span> <span class="n">ram</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;:memory:&quot;</span><span class="p">,</span> <span class="n">check_same_thread</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ram</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">check_same_thread</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;DROP TABLE IF EXISTS &quot;Models&quot;;&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;DROP TABLE IF EXISTS &quot;Links&quot;;&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;DROP TABLE IF EXISTS &quot;Nodes&quot;;&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;DROP TABLE IF EXISTS &quot;Profile&quot;;&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;DROP TABLE IF EXISTS &quot;Load&quot;;&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;DROP TABLE IF EXISTS &quot;LineLoad&quot;;&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;DROP TABLE IF EXISTS &quot;VisualizerSettings&quot;;&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;DROP TABLE IF EXISTS &quot;DeletedNodes&quot;;&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;DROP TABLE IF EXISTS &quot;DeletedLinks&quot;;&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="c1"># Create statements, see database model in documentation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;CREATE TABLE &quot;Models&quot; (</span>
<span class="s2">                                &quot;id&quot;	INTEGER NOT NULL,</span>
<span class="s2">                                &quot;name&quot;	TEXT NOT NULL,</span>
<span class="s2">                                &quot;changed_on&quot; TEXT,</span>
<span class="s2">                                PRIMARY KEY(&quot;id&quot;)</span>
<span class="s2">        );&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;CREATE TABLE IF NOT EXISTS &quot;Links&quot; (</span>
<span class="s2">                                &quot;id&quot;	INTEGER NOT NULL UNIQUE,</span>
<span class="s2">                                &quot;m_id&quot;  INTEGER NOT NULL,</span>
<span class="s2">                                &quot;v_x&quot;   FLOAT NOT NULL,</span>
<span class="s2">                                &quot;v_y&quot;   FLOAT NOT NULL,</span>
<span class="s2">                                &quot;v_z&quot;   FLOAT NOT NULL,</span>
<span class="s2">                                &quot;n1_id&quot;	INTEGER NOT NULL,</span>
<span class="s2">                                &quot;n2_id&quot;	INTEGER NOT NULL,</span>
<span class="s2">                                &quot;Profile_id&quot;	INTEGER,</span>
<span class="s2">                                &quot;ux1&quot; INTEGER NULL,</span>
<span class="s2">                                &quot;uy1&quot; INTEGER NULL,</span>
<span class="s2">                                &quot;uz1&quot; INTEGER NULL,</span>
<span class="s2">                                &quot;phix1&quot; INTEGER NULL,</span>
<span class="s2">                                &quot;phiy1&quot; INTEGER NULL,</span>
<span class="s2">                                &quot;phiz1&quot; INTEGER NULL,</span>
<span class="s2">                                &quot;ux2&quot; INTEGER NULL,</span>
<span class="s2">                                &quot;uy2&quot; INTEGER NULL,</span>
<span class="s2">                                &quot;uz2&quot; INTEGER NULL,</span>
<span class="s2">                                &quot;phix2&quot; INTEGER NULL,</span>
<span class="s2">                                &quot;phiy2&quot; INTEGER NULL,</span>
<span class="s2">                                &quot;phiz2&quot; INTEGER NULL,</span>
<span class="s2">                                PRIMARY KEY(&quot;id&quot;),</span>
<span class="s2">                                FOREIGN KEY(&quot;n1_id&quot;) REFERENCES &quot;Nodes&quot;(&quot;id&quot;) ON DELETE CASCADE,</span>
<span class="s2">                                FOREIGN KEY(&quot;n2_id&quot;) REFERENCES &quot;Nodes&quot;(&quot;id&quot;) ON DELETE CASCADE,</span>
<span class="s2">                                FOREIGN KEY(&quot;Profile_id&quot;) REFERENCES &quot;Profile&quot;(&quot;id&quot;),</span>
<span class="s2">                                FOREIGN KEY(&quot;m_id&quot;) REFERENCES &quot;Models&quot;(&quot;id&quot;) ON DELETE CASCADE</span>
<span class="s2">        );&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;CREATE TABLE IF NOT EXISTS &quot;Nodes&quot; (</span>
<span class="s2">                                &quot;id&quot;	INTEGER NOT NULL UNIQUE,</span>
<span class="s2">                                &quot;m_id&quot;  INTEGER NOT NULL,</span>
<span class="s2">                                &quot;x&quot;	REAL NOT NULL,</span>
<span class="s2">                                &quot;y&quot;	REAL NOT NULL,</span>
<span class="s2">                                &quot;z&quot;	REAL NOT NULL,</span>
<span class="s2">                                &quot;u_x&quot;	INTEGER NOT NULL,</span>
<span class="s2">                                &quot;u_y&quot;	INTEGER NOT NULL,</span>
<span class="s2">                                &quot;u_z&quot;	INTEGER NOT NULL,</span>
<span class="s2">                                &quot;phi_x&quot;	INTEGER NOT NULL,</span>
<span class="s2">                                &quot;phi_y&quot;	INTEGER NOT NULL,</span>
<span class="s2">                                &quot;phi_z&quot;	INTEGER NOT NULL,</span>
<span class="s2">                                FOREIGN KEY(&quot;m_id&quot;) REFERENCES &quot;Models&quot;(&quot;id&quot;) ON DELETE CASCADE,</span>
<span class="s2">                                PRIMARY KEY(&quot;id&quot;)</span>
<span class="s2">        );&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;CREATE TABLE IF NOT EXISTS &quot;Profile&quot; (</span>
<span class="s2">                                &quot;id&quot;	INTEGER NOT NULL,</span>
<span class="s2">                                &quot;E&quot;	    REAL,</span>
<span class="s2">                                &quot;G&quot;	    REAL,</span>
<span class="s2">                                &quot;A&quot;     REAL,</span>
<span class="s2">                                &quot;Iy&quot;	REAL,</span>
<span class="s2">                                &quot;Iz&quot;	REAL,</span>
<span class="s2">                                &quot;kv&quot;	REAL,</span>
<span class="s2">                                PRIMARY KEY(&quot;id&quot;)</span>
<span class="s2">        );&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;CREATE TABLE IF NOT EXISTS &quot;Load&quot; (</span>
<span class="s2">                                &quot;id&quot;	INTEGER NOT NULL UNIQUE,</span>
<span class="s2">                                &quot;m_id&quot;  INTEGER NOT NULL,</span>
<span class="s2">                                &quot;x&quot;	REAL NOT NULL,</span>
<span class="s2">                                &quot;y&quot;	REAL NOT NULL,</span>
<span class="s2">                                &quot;z&quot;	REAL NOT NULL,</span>
<span class="s2">                                &quot;m_x&quot;	REAL NOT NULL,</span>
<span class="s2">                                &quot;m_y&quot;	REAL NOT NULL,</span>
<span class="s2">                                &quot;m_z&quot;	REAL NOT NULL,</span>
<span class="s2">                                &quot;node_id&quot; INTEGER NOT NULL,</span>
<span class="s2">                                &quot;lineload_id&quot; INTEGER,</span>
<span class="s2">                                FOREIGN KEY(&quot;node_id&quot;) REFERENCES &quot;Nodes&quot;(&quot;id&quot;) ON DELETE CASCADE,</span>
<span class="s2">                                FOREIGN KEY(&quot;lineload_id&quot;) REFERENCES &quot;Lineload&quot;(&quot;id&quot;) ON DELETE CASCADE,</span>
<span class="s2">                                FOREIGN KEY(&quot;m_id&quot;) REFERENCES &quot;Models&quot;(&quot;id&quot;) ON DELETE CASCADE,</span>
<span class="s2">                                PRIMARY KEY(&quot;id&quot;)</span>
<span class="s2">        );&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;CREATE TABLE IF NOT EXISTS &quot;Lineload&quot; (</span>
<span class="s2">                                &quot;id&quot;	INTEGER NOT NULL UNIQUE,</span>
<span class="s2">                                &quot;m_id&quot;  INTEGER NOT NULL,</span>
<span class="s2">                                &quot;qx&quot;    REAL,</span>
<span class="s2">                                &quot;qy&quot;    REAL,</span>
<span class="s2">                                &quot;qz&quot;    REAL,</span>
<span class="s2">                                &quot;qw&quot;    REAL,</span>
<span class="s2">                                &quot;link_id&quot; INTEGER NOT NULL,</span>
<span class="s2">                                FOREIGN KEY(&quot;link_id&quot;) REFERENCES &quot;Links&quot;(&quot;id&quot;) ON DELETE CASCADE,</span>
<span class="s2">                                FOREIGN KEY(&quot;m_id&quot;) REFERENCES &quot;Models&quot;(&quot;id&quot;) ON DELETE CASCADE,</span>
<span class="s2">                                PRIMARY KEY(&quot;id&quot;)</span>
<span class="s2">        );&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="c1"># TODO: add not null constraints after finishing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;CREATE TABLE &quot;VisualizerSettings&quot; (</span>
<span class="s2">                                &quot;id&quot;	INTEGER,</span>
<span class="s2">                                &quot;grid_x1origin&quot;	REAL,</span>
<span class="s2">                                &quot;grid_x2origin&quot;	REAL,</span>
<span class="s2">                                &quot;grid_x3origin&quot;	REAL,</span>
<span class="s2">                                &quot;grid_n1&quot;	REAL,</span>
<span class="s2">                                &quot;grid_n2&quot;	REAL,</span>
<span class="s2">                                &quot;grid_n3&quot;	REAL,</span>
<span class="s2">                                &quot;grid_xtick&quot;	REAL,</span>
<span class="s2">                                &quot;grid_ytick&quot;	REAL,</span>
<span class="s2">                                &quot;view_dim&quot;      REAL,</span>
<span class="s2">                                &quot;show_labels&quot;   BLOB,</span>
<span class="s2">                                &quot;show_local_systems&quot; BLOB,</span>
<span class="s2">                                &quot;show_bc&quot; BLOB,</span>
<span class="s2">                                &quot;show_node_loads&quot; BLOB,</span>
<span class="s2">                                &quot;show_line_loads&quot; BLOB,</span>
<span class="s2">                                &quot;show_color_bar&quot; BLOB,</span>
<span class="s2">                                &quot;disp_nodes&quot; BLOB,</span>
<span class="s2">                                &quot;disp_elements&quot; BLOB,</span>
<span class="s2">                                &quot;nodes_sup_forces_trans&quot; BLOB,</span>
<span class="s2">                                &quot;nodes_sup_forces_mom&quot; BLOB,</span>
<span class="s2">                                &quot;elements_section_forces&quot; INTEGER,</span>
<span class="s2">                                &quot;displacements_scale&quot; REAL,</span>
<span class="s2">                                PRIMARY KEY(&quot;id&quot;)</span>
<span class="s2">        );&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="c1"># create proper application id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;PRAGMA application_id=</span><span class="si">{id}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">APPLICATION_ID</span><span class="p">))</span>
        <span class="c1"># commit transaction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></div>

<div class="viewcode-block" id="Database.check_database"><a class="viewcode-back" href="../../api.html#beamon.database.Database.check_database">[docs]</a>    <span class="k">def</span> <span class="nf">check_database</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks if the database has already been created or fails integrity check. Also checks if the following tables</span>
<span class="sd">        has dublicate entries: Nodes, Links</span>

<span class="sd">        :return: True/False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check if the database has been created</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;PRAGMA application_id;&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">constants</span><span class="o">.</span><span class="n">APPLICATION_ID</span><span class="p">:</span>
            <span class="c1"># abort</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># check databases integrity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;PRAGMA integrity_check;&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ok&#39;</span><span class="p">:</span>
            <span class="c1"># no errors occured</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># abort</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;PRAGMA foreign_key_check;&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="c1"># no errors occured</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># abort</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># check if links table has duplicates</span>
        <span class="n">l_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM Links;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="n">duplicate_rows_df</span> <span class="o">=</span> <span class="n">l_df</span><span class="p">[</span><span class="n">l_df</span><span class="o">.</span><span class="n">duplicated</span><span class="p">([</span><span class="s1">&#39;n1_id&#39;</span><span class="p">,</span> <span class="s1">&#39;n2_id&#39;</span><span class="p">])]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">duplicate_rows_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Database.add_model"><a class="viewcode-back" href="../../api.html#beamon.database.Database.add_model">[docs]</a>    <span class="k">def</span> <span class="nf">add_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Adds a new model to db and returns newly added model number</span>

<span class="sd">        :param m_name: new model name</span>
<span class="sd">        :type m_name: string</span>
<span class="sd">        :return: model number</span>
<span class="sd">        :rtype: integer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO Models (name, changed_on) VALUES (&#39;</span><span class="si">{m_name}</span><span class="s2">&#39;, &#39;</span><span class="si">{time}</span><span class="s2">&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">m_name</span><span class="o">=</span><span class="n">m_name</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">-%m-%Y %H:%M&quot;</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="c1"># retrieve last added primary key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT last_insert_rowid()&quot;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="nf">remove_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DELETE FROM Models WHERE id=</span><span class="si">{m_id}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m_id</span><span class="o">=</span><span class="n">m_id</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">contains_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT id FROM Models WHERE id=</span><span class="si">{m_id}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m_id</span><span class="o">=</span><span class="n">m_id</span><span class="p">))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

<div class="viewcode-block" id="Database.get_models"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_models">[docs]</a>    <span class="k">def</span> <span class="nf">get_models</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get all models as pandas dataframe</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">sql</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="s2">&quot;SELECT id, name, changed_on FROM Models&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">get_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM Models WHERE id=</span><span class="si">{m_id}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m_id</span><span class="o">=</span><span class="n">m_id</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">get_model_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT count(id) FROM Nodes WHERE m_id=</span><span class="si">{</span><span class="n">m_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;node count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT count(id) FROM Links WHERE m_id=</span><span class="si">{</span><span class="n">m_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;element count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;joint count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_joints</span><span class="p">(</span><span class="n">m_id</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT count(DISTINCT profile_id) FROM Links WHERE m_id=</span><span class="si">{</span><span class="n">m_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;profile variety&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">stats</span>

    <span class="k">def</span> <span class="nf">change_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">m_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains_model</span><span class="p">(</span><span class="n">m_id</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;UPDATE Models SET name=&#39;</span><span class="si">{m_name}</span><span class="s2">&#39; WHERE id=</span><span class="si">{m_id}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m_name</span><span class="o">=</span><span class="n">m_name</span><span class="p">,</span> <span class="n">m_id</span><span class="o">=</span><span class="n">m_id</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_change_model_last_modified</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">time_stamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">-%m-%Y %H:%M&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;UPDATE Models SET changed_on=&#39;</span><span class="si">{</span><span class="n">time_stamp</span><span class="si">}</span><span class="s2">&#39; WHERE id=</span><span class="si">{</span><span class="n">m_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<div class="viewcode-block" id="Database.contains_node"><a class="viewcode-back" href="../../api.html#beamon.database.Database.contains_node">[docs]</a>    <span class="k">def</span> <span class="nf">contains_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Check if node with specific index number exists.</span>
<span class="sd">        If model number is given node sub index number will be searched instead.</span>

<span class="sd">        :param index: node id inside a model (not pk)</span>
<span class="sd">        :type index: integer</span>
<span class="sd">        :param m_id: model number</span>
<span class="sd">        :type m_id: integer</span>
<span class="sd">        :return: True if node exist, False if nodes doesnt exist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">m_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_node_super_index</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">m_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT id from Nodes WHERE id=</span><span class="si">{index}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">))</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span></div>

    <span class="k">def</span> <span class="nf">_get_node_sub_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Gets row number of id inside it&#39;s specified model</span>

<span class="sd">        :param node_id: node index</span>
<span class="sd">        :type node_id: integer</span>
<span class="sd">        :param m_id: model number</span>
<span class="sd">        :type m_id: integer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT RowNum as id FROM</span>
<span class="s2">         (SELECT id, row_number() OVER (ORDER BY id) RowNum FROM Nodes WHERE m_id = </span><span class="si">{m_id}</span><span class="s2">) WHERE id=</span><span class="si">{n_id}</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">m_id</span><span class="o">=</span><span class="n">m_id</span><span class="p">,</span> <span class="n">n_id</span><span class="o">=</span><span class="n">node_id</span>
        <span class="p">))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_get_node_super_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Gets node primary key from node row number inside a specified model</span>

<span class="sd">        :param node_id: node index inside a model</span>
<span class="sd">        :type node_id: integer</span>
<span class="sd">        :param m_id: nodel number</span>
<span class="sd">        :type m_id: integer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT id FROM</span>
<span class="s2">                 (SELECT id, row_number() OVER (ORDER BY id) RowNum FROM Nodes WHERE m_id = </span><span class="si">{m_id}</span><span class="s2">) WHERE RowNum=</span><span class="si">{n_id}</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">m_id</span><span class="o">=</span><span class="n">m_id</span><span class="p">,</span> <span class="n">n_id</span><span class="o">=</span><span class="n">node_id</span>
        <span class="p">))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">raise</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<div class="viewcode-block" id="Database.has_nodes"><a class="viewcode-back" href="../../api.html#beamon.database.Database.has_nodes">[docs]</a>    <span class="k">def</span> <span class="nf">has_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks if there is any nodes in a model</span>

<span class="sd">        :param m_id: model id</span>
<span class="sd">        :type m_id: integer</span>
<span class="sd">        :return: True/False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT id FROM Nodes WHERE m_id=</span><span class="si">{m_id}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m_id</span><span class="o">=</span><span class="n">m_id</span><span class="p">))</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">results</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Database.add_node"><a class="viewcode-back" href="../../api.html#beamon.database.Database.add_node">[docs]</a>    <span class="k">def</span> <span class="nf">add_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">u_x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">u_y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">u_z</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">phi_x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">phi_y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">phi_z</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;adds a node with coordinates x,y,z and the freedom of movement for all 6 degrees of freedom (dof) to a model</span>
<span class="sd">        with given model number.</span>

<span class="sd">        If dof numbers where not given default values will be used.</span>
<span class="sd">        Default values for dof values [u_x, .. ,phi_z] is a vector with ones [1,...,1].</span>

<span class="sd">        :param m_id: Model id</span>
<span class="sd">        :type m_id: integer</span>
<span class="sd">        :param x: x coordinate</span>
<span class="sd">        :type x: float</span>
<span class="sd">        :param y: y coordinate</span>
<span class="sd">        :type y: float</span>
<span class="sd">        :param z: z coordinate</span>
<span class="sd">        :type z: float</span>
<span class="sd">        :param u_x: dof translation in x direction</span>
<span class="sd">        :type u_x: 0 or 1</span>
<span class="sd">        :param u_y: dof translation in y direction</span>
<span class="sd">        :type u_y: 0 or 1</span>
<span class="sd">        :param u_z: dof translation in z direction</span>
<span class="sd">        :type u_z: 0 or 1</span>
<span class="sd">        :param phi_x: dof translation in phi_x direction</span>
<span class="sd">        :type phi_x: 0 or 1</span>
<span class="sd">        :param phi_y: dof translation in phi_y direction</span>
<span class="sd">        :type phi_y: 0 or 1</span>
<span class="sd">        :param phi_z: dof translation in phi_z direction</span>
<span class="sd">        :type phi_z: 0 or 1</span>
<span class="sd">        :return: False: if node already exists, m_id if new node was added</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># add a node with specific data</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">(</span><span class="n">m_id</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">u_x</span><span class="p">,</span> <span class="n">u_y</span><span class="p">,</span> <span class="n">u_z</span><span class="p">,</span> <span class="n">phi_x</span><span class="p">,</span> <span class="n">phi_y</span><span class="p">,</span> <span class="n">phi_z</span><span class="p">)</span>
        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;invalid input&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s1">&#39;INSERT INTO Nodes (id, m_id, x,y,z,u_x,u_y,u_z,phi_x,phi_y,phi_z) VALUES (NULL, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)&#39;</span><span class="p">,</span>
            <span class="n">params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="c1"># get node index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT last_insert_rowid()&quot;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="c1"># update changed date</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_change_model_last_modified</span><span class="p">(</span><span class="n">m_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Database.change_node"><a class="viewcode-back" href="../../api.html#beamon.database.Database.change_node">[docs]</a>    <span class="k">def</span> <span class="nf">change_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">u_x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">u_y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">u_z</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">phi_x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">phi_y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">phi_z</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Changes node information with specified index number.</span>

<span class="sd">        :param index: node id</span>
<span class="sd">        :type index: integer</span>
<span class="sd">        :param x: x coordinate</span>
<span class="sd">        :type x: float</span>
<span class="sd">        :param y: y coordinate</span>
<span class="sd">        :type y: float</span>
<span class="sd">        :param z: z coordinate</span>
<span class="sd">        :type z: float</span>
<span class="sd">        :param u_x: dof translation in x direction</span>
<span class="sd">        :type u_x: 0 or 1</span>
<span class="sd">        :param u_y: dof translation in y direction</span>
<span class="sd">        :type u_y: 0 or 1</span>
<span class="sd">        :param u_z: dof translation in z direction</span>
<span class="sd">        :type u_z: 0 or 1</span>
<span class="sd">        :param phi_x: dof translation in phi_x direction</span>
<span class="sd">        :type phi_x: 0 or 1</span>
<span class="sd">        :param phi_y: dof translation in phi_y direction</span>
<span class="sd">        :type phi_y: 0 or 1</span>
<span class="sd">        :param phi_z: dof translation in phi_z direction</span>
<span class="sd">        :type phi_z: 0 or 1</span>
<span class="sd">        :return: True/False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">u_x</span><span class="p">,</span> <span class="n">u_y</span><span class="p">,</span> <span class="n">u_z</span><span class="p">,</span> <span class="n">phi_x</span><span class="p">,</span> <span class="n">phi_y</span><span class="p">,</span> <span class="n">phi_z</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;invalid input&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains_node</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s1">&#39;UPDATE Nodes SET x=</span><span class="si">{x}</span><span class="s1">, y=</span><span class="si">{y}</span><span class="s1">,z=</span><span class="si">{z}</span><span class="s1">,u_x=</span><span class="si">{u_x}</span><span class="s1">,u_y=</span><span class="si">{u_y}</span><span class="s1">,u_z=</span><span class="si">{u_z}</span><span class="s1">,phi_x=</span><span class="si">{phi_x}</span><span class="s1">,phi_y=</span><span class="si">{phi_y}</span><span class="s1">, phi_z=</span><span class="si">{phi_z}</span><span class="s1"> WHERE id=</span><span class="si">{index}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">u_x</span><span class="o">=</span><span class="n">u_x</span><span class="p">,</span> <span class="n">u_y</span><span class="o">=</span><span class="n">u_y</span><span class="p">,</span> <span class="n">u_z</span><span class="o">=</span><span class="n">u_z</span><span class="p">,</span> <span class="n">phi_x</span><span class="o">=</span><span class="n">phi_x</span><span class="p">,</span> <span class="n">phi_y</span><span class="o">=</span><span class="n">phi_y</span><span class="p">,</span> <span class="n">phi_z</span><span class="o">=</span><span class="n">phi_z</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT m_id FROM Nodes WHERE id=</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">m_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_change_model_last_modified</span><span class="p">(</span><span class="n">m_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Database.remove_node"><a class="viewcode-back" href="../../api.html#beamon.database.Database.remove_node">[docs]</a>    <span class="k">def</span> <span class="nf">remove_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Drops a node from the nodes table.</span>
<span class="sd">        **Warning**: Dependent links and loads entries will be deleted.</span>

<span class="sd">        :param index: index of the node</span>
<span class="sd">        :return: True: if node has been successfully dropped, False: otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains_node</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">):</span>
            <span class="c1"># all dependencies should be removed to prevent delete anomalies</span>
            <span class="c1"># remove all connected links first</span>
            <span class="c1"># self.cur.execute(&#39;DELETE FROM Links WHERE (n1_id={index} or n2_id={index});&#39;.format(</span>
            <span class="c1">#     index=index))</span>
            <span class="c1"># # remove all forces in relation with the node</span>
            <span class="c1"># self.cur.execute(&#39;DELETE FROM Load WHERE node_id={index};&#39;.format(index=index))</span>
            <span class="c1"># finally delete the node</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT m_id FROM Nodes WHERE id=</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">m_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_change_model_last_modified</span><span class="p">(</span><span class="n">m_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;DELETE from Nodes WHERE id=</span><span class="si">{index}</span><span class="s1">;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">))</span>
            <span class="c1"># commit changes to the database</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="c1"># # update deleted nodes array</span>
            <span class="c1"># self.deleted_nodes.put(index)</span>

            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Database.change_dof"><a class="viewcode-back" href="../../api.html#beamon.database.Database.change_dof">[docs]</a>    <span class="k">def</span> <span class="nf">change_dof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">u_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">u_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">u_z</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">phi_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">phi_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">phi_z</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;change the degree of freedom for a given node with specified node index. DOF specification:</span>
<span class="sd">         1 is for free movement and 0 is for locked movement in a specified direction.</span>

<span class="sd">        for example (index=300, u_x=1, u_y=1, u_z=1, phi_x=1, phi_y=1, phi_z=0) locks the rotation</span>
<span class="sd">        in global z-axes direction of node 300.</span>

<span class="sd">        :param index: index of the node</span>
<span class="sd">        :param u_x: movement in x direction</span>
<span class="sd">        :param u_y: movement in y direction</span>
<span class="sd">        :param u_z: movement in z direction</span>
<span class="sd">        :param phi_x: rotation in x axes</span>
<span class="sd">        :param phi_y: rotation in y axes</span>
<span class="sd">        :param phi_z: rotation in z axes</span>
<span class="sd">        :return: True: if successfully changed/ False: if node not found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check if node exists</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains_node</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># take values if given</span>
        <span class="k">if</span> <span class="n">u_x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">u_x</span>
        <span class="k">if</span> <span class="n">phi_x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="n">phi_x</span>
        <span class="k">if</span> <span class="n">u_y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="n">u_y</span>
        <span class="k">if</span> <span class="n">phi_y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="n">phi_y</span>
        <span class="k">if</span> <span class="n">u_z</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">z1</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">z1</span> <span class="o">=</span> <span class="n">u_z</span>
        <span class="k">if</span> <span class="n">phi_z</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">z2</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">z2</span> <span class="o">=</span> <span class="n">phi_z</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;UPDATE Nodes SET u_x=</span><span class="si">{x1}</span><span class="s1">,u_y=</span><span class="si">{y1}</span><span class="s1">,u_z=</span><span class="si">{z1}</span><span class="s1">,phi_x=</span><span class="si">{x2}</span><span class="s1">,phi_y=</span><span class="si">{y2}</span><span class="s1">, phi_z=</span><span class="si">{z2}</span><span class="se">\n</span><span class="s1">&#39;</span>
                         <span class="s1">&#39;WHERE id=</span><span class="si">{index}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="o">=</span><span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="o">=</span><span class="n">y2</span><span class="p">,</span> <span class="n">z1</span><span class="o">=</span><span class="n">z1</span><span class="p">,</span> <span class="n">z2</span><span class="o">=</span><span class="n">z2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT m_id FROM Nodes WHERE id=</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">m_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_change_model_last_modified</span><span class="p">(</span><span class="n">m_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Database.get_nodes"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_nodes">[docs]</a>    <span class="k">def</span> <span class="nf">get_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets all nodes coordinates from a specific model</span>

<span class="sd">        :param m_id: model id</span>
<span class="sd">        :type m_id: integer</span>
<span class="sd">        :return: numpy array for each node with the form [x, y, z]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT x,y,z FROM Nodes WHERE m_id=</span><span class="si">{m_id}</span><span class="s2">;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m_id</span><span class="o">=</span><span class="n">m_id</span><span class="p">))</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="Database.get_node"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_node">[docs]</a>    <span class="k">def</span> <span class="nf">get_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; gets the nodes coordinates (x,y,z)</span>

<span class="sd">        :param index: node id</span>
<span class="sd">        :return: None if node not found / numpy array with [x,y,z]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains_node</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT x,y,z FROM Nodes WHERE id=</span><span class="si">{index}</span><span class="s1">;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">))</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">results</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Database.get_all_nodes"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_all_nodes">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets all nodes information in the DataSet from a specified model. Used for the GUI-Table</span>

<span class="sd">        :param m_id: model id</span>
<span class="sd">        :type m_id: integer</span>
<span class="sd">        :return: table [x, y, z, u_x, u_y, u_z, phi_x, phi_y, phi_z]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># sort all nodes indexes first</span>
        <span class="c1"># self.sort_node_indexes()</span>
        <span class="k">return</span> <span class="n">sql</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT id,x,y,z,u_x,u_y,u_z,phi_x,phi_y,phi_z FROM Nodes WHERE m_id= </span><span class="si">{</span><span class="n">m_id</span><span class="si">}</span><span class="s2">;&quot;</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span></div>

<div class="viewcode-block" id="Database.get_dof"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_dof">[docs]</a>    <span class="k">def</span> <span class="nf">get_dof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the dof values of a specified node.</span>

<span class="sd">        :param index: of the node</span>
<span class="sd">        :return: [u_x,u_y,u_z,phi_x,phi_y,phi_z]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s1">&#39;SELECT x,y,z,u_x,u_y,u_z,phi_x,phi_y,phi_z FROM Nodes WHERE id=</span><span class="si">{index}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Database.get_all_dof"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_all_dof">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_dof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets all nodes information that has at least one dof number equals to 1 (locked) from a specified model.</span>

<span class="sd">        :param m_id: model id</span>
<span class="sd">        :type m_id: integer</span>
<span class="sd">        :return: [x,y,z,u_x,u_y,u_z,phi_x,phi_y,phi_z]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s1">&#39;SELECT x,y,z,u_x,u_y,u_z,phi_x,phi_y,phi_z FROM Nodes WHERE (u_x=1 or u_y=1 or u_z=1 or phi_x=1 or phi_y=1 or phi_z=1) and m_id=</span><span class="si">{m_id}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">m_id</span><span class="o">=</span><span class="n">m_id</span><span class="p">))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Database.get_nodes_indexes_with_bc"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_nodes_indexes_with_bc">[docs]</a>    <span class="k">def</span> <span class="nf">get_nodes_indexes_with_bc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets all nodes id numbers which have boundary conditions defined on them for a specified model.</span>
<span class="sd">         Similar to get_all_dof but delivers nodes indices instead of all nodes information.</span>

<span class="sd">        :param m_id: model id</span>
<span class="sd">        :type m_id: integer</span>
<span class="sd">        :return: nodes indices</span>
<span class="sd">        :rtype: integer vector</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;SELECT id FROM Nodes WHERE (u_x=1 or u_y=1 or u_z=1 or phi_x=1 or phi_y=1 or phi_z=1) and m_id=</span><span class="si">{m_id}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">m_id</span><span class="o">=</span><span class="n">m_id</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Database.get_bc"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_bc">[docs]</a>    <span class="k">def</span> <span class="nf">get_bc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get only bc information from nodes for a specified model.</span>

<span class="sd">        :param m_id: model id</span>
<span class="sd">        :type m_id: integer</span>
<span class="sd">        :return: [u_x,u_y,u_z,phi_x,phi_y,phi_z]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT u_x,u_y,u_z,phi_x,phi_y,phi_z FROM Nodes WHERE m_id=</span><span class="si">{m_id}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m_id</span><span class="o">=</span><span class="n">m_id</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span></div>

<div class="viewcode-block" id="Database.contains_link"><a class="viewcode-back" href="../../api.html#beamon.database.Database.contains_link">[docs]</a>    <span class="k">def</span> <span class="nf">contains_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index1</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">index2</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;If only index1 is given: see if a link with index1 exists.</span>
<span class="sd">        if index1 and m_id are given: see if a link with sub index exists in model with specified model number</span>
<span class="sd">        If index1, index2 and model number are given: see if a link with the nodes sub index1 and sub index2 exists.</span>

<span class="sd">        :param index1: Integer</span>
<span class="sd">        :param index2: Integer</span>
<span class="sd">        :param m_id: model number</span>
<span class="sd">        :type m_id: integer</span>
<span class="sd">        :return: True/False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">index2</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">m_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT id FROM Links WHERE id=</span><span class="si">{index}</span><span class="s1">;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index1</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">index2</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">m_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">link_super_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_link_super_index</span><span class="p">(</span><span class="n">index1</span><span class="p">,</span> <span class="n">m_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">link_super_index</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT id FROM Links WHERE id = </span><span class="si">{l_id}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l_id</span><span class="o">=</span><span class="n">index1</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">m_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;missing model number&quot;</span><span class="p">)</span>
            <span class="n">n1_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_node_super_index</span><span class="p">(</span><span class="n">index1</span><span class="p">,</span> <span class="n">m_id</span><span class="p">)</span>
            <span class="n">n2_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_node_super_index</span><span class="p">(</span><span class="n">index2</span><span class="p">,</span> <span class="n">m_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">n1_id</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">n2_id</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="s1">&#39;SELECT id FROM Links WHERE (n1_id=</span><span class="si">{index1}</span><span class="s1"> and n2_id=</span><span class="si">{index2}</span><span class="s1">) or (n1_id=</span><span class="si">{index2}</span><span class="s1"> and n2_id=</span><span class="si">{index1}</span><span class="s1">);&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">index1</span><span class="o">=</span><span class="n">n1_id</span><span class="p">,</span> <span class="n">index2</span><span class="o">=</span><span class="n">n2_id</span><span class="p">))</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">results</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Database.has_links"><a class="viewcode-back" href="../../api.html#beamon.database.Database.has_links">[docs]</a>    <span class="k">def</span> <span class="nf">has_links</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks if there is any links in a model.</span>

<span class="sd">        :param m_id: model id</span>
<span class="sd">        :type m_id: integer</span>
<span class="sd">        :return: True/False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT id FROM Links WHERE m_id=</span><span class="si">{m_id}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m_id</span><span class="o">=</span><span class="n">m_id</span><span class="p">))</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">results</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Database.add_link"><a class="viewcode-back" href="../../api.html#beamon.database.Database.add_link">[docs]</a>    <span class="k">def</span> <span class="nf">add_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index1</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">index2</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">dof</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">profile_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">v_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">v_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">v_z</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds a link from node with id index1 to node with id index2 and profile with profile_id to a model with m_id.</span>

<span class="sd">        :param index1: starting node index</span>
<span class="sd">        :param index2: ending node index</span>
<span class="sd">        :param m_id: model id</span>
<span class="sd">        :type m_id: integer</span>
<span class="sd">        :param dof: degrees of freedom [ux1, uy1, uz1, phix1, ... , uz2, phix2, phiy2, phiz2]</span>
<span class="sd">        :param profile_id: optional index of the profile</span>
<span class="sd">        :param v_x: x component of the direction determiner of the z local axes</span>
<span class="sd">        :param v_y: y component of the direction determiner of the z local axes</span>
<span class="sd">        :param v_z: z component of the direction determiner of the z local axes</span>
<span class="sd">        :return: True: if successfully added a link, False: if one of the given indices don&#39;t exist</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains_node</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index1</span><span class="p">,</span> <span class="n">m_id</span><span class="o">=</span><span class="n">m_id</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains_node</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index2</span><span class="p">,</span> <span class="n">m_id</span><span class="o">=</span><span class="n">m_id</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="n">index1</span> <span class="o">!=</span> <span class="n">index2</span><span class="p">):</span>
            <span class="n">n1_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_node_super_index</span><span class="p">(</span><span class="n">index1</span><span class="p">,</span> <span class="n">m_id</span><span class="p">)</span>
            <span class="n">n2_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_node_super_index</span><span class="p">(</span><span class="n">index2</span><span class="p">,</span> <span class="n">m_id</span><span class="p">)</span>
            <span class="c1"># get the default vector</span>
            <span class="k">if</span> <span class="n">v_x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_link_orientation</span><span class="p">(</span><span class="n">n1_id</span><span class="p">,</span> <span class="n">n2_id</span><span class="p">)</span>
                <span class="n">v_x</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">v_y</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">v_z</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">dof</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dof</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_static_edof</span><span class="p">(</span><span class="n">n1_id</span><span class="p">,</span> <span class="n">n2_id</span><span class="p">,</span> <span class="n">m_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">profile_id</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">params</span> <span class="o">=</span> <span class="p">(</span><span class="n">m_id</span><span class="p">,</span> <span class="n">v_x</span><span class="p">,</span> <span class="n">v_y</span><span class="p">,</span> <span class="n">v_z</span><span class="p">,</span> <span class="n">n1_id</span><span class="p">,</span> <span class="n">n2_id</span><span class="p">,</span> <span class="n">dof</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dof</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dof</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">dof</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">dof</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">dof</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">dof</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>
                          <span class="n">dof</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">dof</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">dof</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">dof</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">dof</span><span class="p">[</span><span class="mi">11</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                    <span class="s1">&#39;INSERT INTO Links (id, m_id, v_x, v_y, v_z, n1_id, n2_id, Profile_id, ux1,uy1,uz1,phix1,phiy1,phiz1,ux2,uy2,uz2,phix2,phiy2,phiz2) VALUES (NULL, ?,?,?,?,?,?,NULL,?,?,?,?,?,?,?,?,?,?,?,?);&#39;</span><span class="p">,</span>
                    <span class="n">params</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">params</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">m_id</span><span class="p">,</span> <span class="n">v_x</span><span class="p">,</span> <span class="n">v_y</span><span class="p">,</span> <span class="n">v_z</span><span class="p">,</span> <span class="n">n1_id</span><span class="p">,</span> <span class="n">n2_id</span><span class="p">,</span> <span class="n">profile_id</span><span class="p">,</span> <span class="n">dof</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dof</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dof</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">dof</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">dof</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">dof</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
                    <span class="n">dof</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>
                    <span class="n">dof</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">dof</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">dof</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">dof</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">dof</span><span class="p">[</span><span class="mi">11</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                    <span class="s1">&#39;INSERT INTO Links (id, m_id, v_x, v_y, v_z, n1_id, n2_id, Profile_id, ux1,uy1,uz1,phix1,phiy1,phiz1,ux2,uy2,uz2,phix2,phiy2,phiz2) VALUES (NULL, ?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?);&#39;</span><span class="p">,</span>
                    <span class="n">params</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="c1"># get link index</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT last_insert_rowid()&quot;</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_change_model_last_modified</span><span class="p">(</span><span class="n">m_id</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Database.change_link"><a class="viewcode-back" href="../../api.html#beamon.database.Database.change_link">[docs]</a>    <span class="k">def</span> <span class="nf">change_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n1_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n2_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">v_x</span><span class="p">,</span> <span class="n">v_y</span><span class="p">,</span> <span class="n">v_z</span><span class="p">,</span> <span class="n">profile_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Changes link values with specific index and model number</span>

<span class="sd">        :return: True/False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">n1_id</span><span class="p">,</span> <span class="n">n2_id</span><span class="p">,</span> <span class="n">v_x</span><span class="p">,</span> <span class="n">v_y</span><span class="p">,</span> <span class="n">v_z</span><span class="p">,</span> <span class="n">profile_id</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains_node</span><span class="p">(</span><span class="n">n1_id</span><span class="p">,</span> <span class="n">m_id</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains_node</span><span class="p">(</span><span class="n">n2_id</span><span class="p">,</span> <span class="n">m_id</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">profile_id</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">profile_id</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">index1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_node_super_index</span><span class="p">(</span><span class="n">n1_id</span><span class="p">,</span> <span class="n">m_id</span><span class="p">)</span>
            <span class="n">index2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_node_super_index</span><span class="p">(</span><span class="n">n2_id</span><span class="p">,</span> <span class="n">m_id</span><span class="p">)</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">(</span><span class="n">index1</span><span class="p">,</span> <span class="n">index2</span><span class="p">,</span> <span class="n">v_x</span><span class="p">,</span> <span class="n">v_y</span><span class="p">,</span> <span class="n">v_z</span><span class="p">,</span> <span class="n">profile_id</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="s2">&quot;UPDATE Links SET n1_id=?, n2_id=?, v_x=?, v_y=?,v_z=?, profile_id=? WHERE id=?&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_edof</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_default_edof</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">m_id</span><span class="p">),</span> <span class="n">e_index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_change_model_last_modified</span><span class="p">(</span><span class="n">m_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Database.remove_link"><a class="viewcode-back" href="../../api.html#beamon.database.Database.remove_link">[docs]</a>    <span class="k">def</span> <span class="nf">remove_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Drops a link from the links table.</span>

<span class="sd">        :param index: index of the link</span>
<span class="sd">        :return: True: if link has been successfully droppend, False: otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains_link</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
            <span class="c1"># all dependencies should be removed to prevent delete anomalies</span>
            <span class="c1"># remove all loads in relation with the link (solved thanks to ON DELETE CASCADE?)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT m_id FROM Links WHERE id=</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">m_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_change_model_last_modified</span><span class="p">(</span><span class="n">m_id</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;DELETE from Links WHERE id=</span><span class="si">{index}</span><span class="s1">;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Database.get_default_link_orientation"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_default_link_orientation">[docs]</a>    <span class="k">def</span> <span class="nf">get_default_link_orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index1</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">index2</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the default orientation vector of the element from starting node with index1 and ending node with index2</span>

<span class="sd">        :param index1: index of the starting node</span>
<span class="sd">        :param index2: index of the ending node</span>
<span class="sd">        :return: [v_x, v_y, v_z]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_link_direction</span><span class="p">(</span><span class="n">index1</span><span class="p">,</span> <span class="n">index2</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Database.get_link_direction"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_link_direction">[docs]</a>    <span class="k">def</span> <span class="nf">get_link_direction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index1</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">index2</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the normalized direction of the Link (local x-axis). Link is specified by starting and</span>
<span class="sd">        ending node indices.</span>

<span class="sd">        :param index1: index of the starting node</span>
<span class="sd">        :param index2: index of the ending node</span>
<span class="sd">        :return: [n_x, n_y, n_z]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">(</span><span class="n">index1</span><span class="p">,</span> <span class="n">index2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s1">&#39;SELECT n2.x-n1.x n_x, n2.y-n1.y n_y, n2.z-n1.z n_z FROM Nodes n1, Nodes n2 WHERE n1.id = ? and n2.id = ?&#39;</span><span class="p">,</span>
            <span class="n">params</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">n</span></div>

<div class="viewcode-block" id="Database.get_links"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_links">[docs]</a>    <span class="k">def</span> <span class="nf">get_links</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets Links information for visualization purposes as line segment information for a specified model.</span>
<span class="sd">        See PyVista line segments definition.</span>

<span class="sd">        :param m_id: model id</span>
<span class="sd">        :type m_id: integer</span>
<span class="sd">        :return: numpy array for line segments with the form [x, y, z]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># self.cur.execute(&quot;SELECT n1_id, n2_id FROM Links;&quot;)</span>
        <span class="c1"># get left coordinates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;SELECT x x1,y y1,z z1 FROM Links l LEFT OUTER JOIN Nodes n ON l.n1_id = n.id WHERE l.m_id=</span><span class="si">{m_id}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">m_id</span><span class="o">=</span><span class="n">m_id</span><span class="p">))</span>
        <span class="n">left_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span>
        <span class="c1"># get right coordinates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;SELECT x x2,y y2,z z2 FROM Links l LEFT OUTER JOIN Nodes n ON l.n2_id = n.id WHERE l.m_id=</span><span class="si">{m_id}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">m_id</span><span class="o">=</span><span class="n">m_id</span><span class="p">))</span>
        <span class="n">right_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span>

        <span class="c1"># if links is empty</span>
        <span class="k">if</span> <span class="n">left_coord</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">right_coord</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="c1"># results array is a 1 dim array containing points representing line segments</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">left_coord</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>  <span class="c1"># preallocate</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">left_coord</span><span class="p">)):</span>
            <span class="n">results</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">left_coord</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">results</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">right_coord</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">idx</span> <span class="o">+=</span> <span class="mi">2</span>

        <span class="k">return</span> <span class="n">results</span></div>

    <span class="k">def</span> <span class="nf">_get_link_super_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">link_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Gets link primary key from links row number inside a specified model</span>

<span class="sd">        :param link_id: link index inside a model</span>
<span class="sd">        :type link_id: integer</span>
<span class="sd">        :param m_id: model number</span>
<span class="sd">        :type m_id: integer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT id FROM</span>
<span class="s2">                 (SELECT id, row_number() OVER (ORDER BY id) RowNum FROM Links WHERE m_id = </span><span class="si">{m_id}</span><span class="s2">) WHERE RowNum=</span><span class="si">{l_id}</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">m_id</span><span class="o">=</span><span class="n">m_id</span><span class="p">,</span> <span class="n">l_id</span><span class="o">=</span><span class="n">link_id</span>
        <span class="p">))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">raise</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<div class="viewcode-block" id="Database.get_all_links"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_all_links">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_links</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets all links in the links table for a specified model.</span>
<span class="sd">        Delivers the table with node&#39;s sub indices.</span>

<span class="sd">        :param m_id: model id</span>
<span class="sd">        :type m_id: integer</span>
<span class="sd">        :return: matrix</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># sort all nodes indexes first</span>
        <span class="c1"># self.sort_node_indexes()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">sql</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span>
            <span class="s2">&quot;SELECT l.id, subs1.RowNum as n1_id, subs2.RowNum as n2_id, l.v_x, l.v_y, l.v_z, l.Profile_id FROM Links l &quot;</span> <span class="o">+</span>
            <span class="sa">f</span><span class="s2">&quot;JOIN (SELECT id, row_number() OVER (ORDER BY id) RowNum FROM Nodes WHERE m_id = </span><span class="si">{</span><span class="n">m_id</span><span class="si">}</span><span class="s2">) subs1 on l.n1_id = subs1.id &quot;</span> <span class="o">+</span>
            <span class="sa">f</span><span class="s2">&quot;JOIN (SELECT id, row_number() OVER (ORDER BY id) RowNum FROM Nodes WHERE m_id = </span><span class="si">{</span><span class="n">m_id</span><span class="si">}</span><span class="s2">) subs2 on l.n2_id = subs2.id &quot;</span> <span class="o">+</span>
            <span class="sa">f</span><span class="s2">&quot;WHERE l.m_id = </span><span class="si">{</span><span class="n">m_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">notnull</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="Database.get_link_with_id"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_link_with_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_link_with_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">link_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets link data with a certain id</span>

<span class="sd">        :param link_id: link id</span>
<span class="sd">        :type link_id: integer</span>
<span class="sd">        :return: link data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM Links WHERE id =</span><span class="si">{link_id}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">link_id</span><span class="o">=</span><span class="n">link_id</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Database.get_link_nodes"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_link_nodes">[docs]</a>    <span class="k">def</span> <span class="nf">get_link_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">link_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets links starting and ending nodes indices.</span>

<span class="sd">        :param link_id: link id</span>
<span class="sd">        :type link_id: integer</span>
<span class="sd">        :return: [n1_id, n2_id]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT n1_id, n2_id FROM Links WHERE id =</span><span class="si">{link_id}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">link_id</span><span class="o">=</span><span class="n">link_id</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Database.get_all_links_profile_indexes"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_all_links_profile_indexes">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_links_profile_indexes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets all the profiles indexes of the existing links in a specified model.</span>

<span class="sd">        :return: None: if link index don&#39;t exist. Otherwise index of the profile</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT Profile_id FROM Links WHERE m_id=</span><span class="si">{m_id}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m_id</span><span class="o">=</span><span class="n">m_id</span><span class="p">))</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">results</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="Database.get_links_profiles"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_links_profiles">[docs]</a>    <span class="k">def</span> <span class="nf">get_links_profiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets profile data from links of a specified model provided their profile id is set.</span>

<span class="sd">        :return: [E, G, A, Iy, Iz, Kv]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;SELECT p.E, p.G, p.A, p.Iy, p.Iz, p.Kv FROM Links l JOIN Profile p ON l.Profile_id = p.id WHERE l.m_id=</span><span class="si">{m_id}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">m_id</span><span class="o">=</span><span class="n">m_id</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span></div>

<div class="viewcode-block" id="Database.get_link_orientations"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_link_orientations">[docs]</a>    <span class="k">def</span> <span class="nf">get_link_orientations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;gets all local z-axes orientation information - plane normal vector (x axes) and v vector components</span>
<span class="sd">        (orientation definition vector for z axes) - from a specified model.</span>

<span class="sd">        :return: x,y,z vectors for local system of all links</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># [n_x, n_y, n_z, v_x, v_y, v_z]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;SELECT n2.x-n1.x n_x, n2.y-n1.y n_y, n2.z-n1.z n_z, L.v_x, L.v_y, L.v_z FROM Links L JOIN Nodes n1 ON L.n1_id = n1.id JOIN Nodes n2 ON L.n2_id = n2.id WHERE L.m_id=</span><span class="si">{m_id}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">m_id</span><span class="o">=</span><span class="n">m_id</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">beamcalc</span><span class="o">.</span><span class="n">get_local_orientation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span></div>

<div class="viewcode-block" id="Database.get_link_orientation"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_link_orientation">[docs]</a>    <span class="k">def</span> <span class="nf">get_link_orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; gets all local z-axes orientation information - plane normal vector (x axes) and v vector components</span>
<span class="sd">        (orientation definition vector for z axes).</span>

<span class="sd">        :param index: link index number</span>
<span class="sd">        :type index: integer</span>
<span class="sd">        :return: x,y,z vectors for local system of the link</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># [n_x, n_y, n_z, v_x, v_y, v_z]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sd">&quot;&quot;&quot;SELECT n2.x-n1.x n_x, n2.y-n1.y n_y, n2.z-n1.z n_z, L.v_x, L.v_y, L.v_z FROM Links L</span>
<span class="sd">                JOIN Nodes n1 ON L.n1_id = n1.id </span>
<span class="sd">                JOIN Nodes n2 ON L.n2_id = n2.id </span>
<span class="sd">                WHERE L.id={index}&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">beamcalc</span><span class="o">.</span><span class="n">get_local_orientation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span></div>

<div class="viewcode-block" id="Database.get_links_starting_points"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_links_starting_points">[docs]</a>    <span class="k">def</span> <span class="nf">get_links_starting_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;gets x,y,z coordinates of all links start points of a specified model.</span>
<span class="sd">        This is being used to plot local coordinate systems of links.</span>

<span class="sd">        :return: [x,y,z]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;SELECT n.x, n.y, n.z FROM Links L JOIN Nodes n ON L.n1_id = n.id WHERE L.m_id=</span><span class="si">{m_id}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m_id</span><span class="o">=</span><span class="n">m_id</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span></div>

<div class="viewcode-block" id="Database.get_links_middle_points"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_links_middle_points">[docs]</a>    <span class="k">def</span> <span class="nf">get_links_middle_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;gets x,y,z coordinates of all links middle points of a specified model.</span>
<span class="sd">        This could be used to plot local coordinate systems of the links</span>

<span class="sd">        :return: [x,y,z]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT n1.x + (n2.x-n1.x)/2 x, n1.y+(n2.y-n1.y)/2 y, n1.z+(n2.z-n1.z)/2 z FROM Links L</span>
<span class="s2">                        JOIN Nodes n1 ON L.n1_id = n1.id</span>
<span class="s2">                        JOIN Nodes n2 ON L.n2_id = n2.id</span>
<span class="s2">                        WHERE L.m_id=</span><span class="si">{m_id}</span><span class="s2"></span>
<span class="s2">                    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m_id</span><span class="o">=</span><span class="n">m_id</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span></div>

<div class="viewcode-block" id="Database.get_links_ending_points"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_links_ending_points">[docs]</a>    <span class="k">def</span> <span class="nf">get_links_ending_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;gets x,y,z coordinates of all links ending points of a specified model.</span>
<span class="sd">        This could be used to plot local coordinate systems of the links.</span>

<span class="sd">        :return: [x,y,z]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT n.x, n.y, n.z FROM Links L</span>
<span class="s2">                        JOIN Nodes n ON L.n2_id = n.id</span>
<span class="s2">                        WHERE L.m_id=</span><span class="si">{m_id}</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m_id</span><span class="o">=</span><span class="n">m_id</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span></div>

<div class="viewcode-block" id="Database.get_link_length"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_link_length">[docs]</a>    <span class="k">def</span> <span class="nf">get_link_length</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the length of a specified link.</span>

<span class="sd">        :param index: index of the link</span>
<span class="sd">        :return: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains_link</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s1">&#39;SELECT n1.x - n2.x, n1.y - n2.y, n1.z - n2.z FROM Links L JOIN Nodes n1 ON L.n1_id = n1.id JOIN Nodes n2 ON L.n2_id = n2.id WHERE L.id = </span><span class="si">{index}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()[</span><span class="mi">0</span><span class="p">]))</span></div>

<div class="viewcode-block" id="Database.get_profiles"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_profiles">[docs]</a>    <span class="k">def</span> <span class="nf">get_profiles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Gets all the profiles which are element properties [E G A I_y I_z K_z].</span>

<span class="sd">        :return: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">sql</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT id, E, G, A, Iy, Iz, kv from Profile&quot;&quot;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span></div>

<div class="viewcode-block" id="Database.change_profile"><a class="viewcode-back" href="../../api.html#beamon.database.Database.change_profile">[docs]</a>    <span class="k">def</span> <span class="nf">change_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">Iy</span><span class="p">,</span> <span class="n">Iz</span><span class="p">,</span> <span class="n">kv</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Changes certain profile values with index</span>

<span class="sd">        :return: True/False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">Iy</span><span class="p">,</span> <span class="n">Iz</span><span class="p">,</span> <span class="n">kv</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;UPDATE Profile SET E=</span><span class="si">{E}</span><span class="s2">, G=</span><span class="si">{G}</span><span class="s2">, A=</span><span class="si">{A}</span><span class="s2">, Iy=</span><span class="si">{Iy}</span><span class="s2">, Iz=</span><span class="si">{Iz}</span><span class="s2">, kv=</span><span class="si">{kv}</span><span class="s2"> WHERE id=</span><span class="si">{index}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">E</span><span class="o">=</span><span class="n">E</span><span class="p">,</span> <span class="n">G</span><span class="o">=</span><span class="n">G</span><span class="p">,</span> <span class="n">A</span><span class="o">=</span><span class="n">A</span><span class="p">,</span> <span class="n">Iy</span><span class="o">=</span><span class="n">Iy</span><span class="p">,</span> <span class="n">Iz</span><span class="o">=</span><span class="n">Iz</span><span class="p">,</span> <span class="n">kv</span><span class="o">=</span><span class="n">kv</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Database.add_profile"><a class="viewcode-back" href="../../api.html#beamon.database.Database.add_profile">[docs]</a>    <span class="k">def</span> <span class="nf">add_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">Iy</span><span class="p">,</span> <span class="n">Iz</span><span class="p">,</span> <span class="n">kv</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds a profile</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">Iy</span><span class="p">,</span> <span class="n">Iz</span><span class="p">,</span> <span class="n">kv</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;INSERT INTO Profile (E, G, A, Iy, Iz, kv) VALUES (</span><span class="si">{E}</span><span class="s2">,</span><span class="si">{G}</span><span class="s2">,</span><span class="si">{A}</span><span class="s2">,</span><span class="si">{Iy}</span><span class="s2">,</span><span class="si">{Iz}</span><span class="s2">,</span><span class="si">{kv}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">E</span><span class="o">=</span><span class="n">E</span><span class="p">,</span> <span class="n">G</span><span class="o">=</span><span class="n">G</span><span class="p">,</span> <span class="n">A</span><span class="o">=</span><span class="n">A</span><span class="p">,</span> <span class="n">Iz</span><span class="o">=</span><span class="n">Iz</span><span class="p">,</span> <span class="n">Iy</span><span class="o">=</span><span class="n">Iy</span><span class="p">,</span> <span class="n">kv</span><span class="o">=</span><span class="n">kv</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT last_insert_rowid()&quot;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Database.remove_profile"><a class="viewcode-back" href="../../api.html#beamon.database.Database.remove_profile">[docs]</a>    <span class="k">def</span> <span class="nf">remove_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Removes the profile with index</span>

<span class="sd">        :param index: of the profile</span>
<span class="sd">        :return: True: successful / False: not successful</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains_profile</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="ow">or</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;DELETE FROM Profile WHERE id=</span><span class="si">{index}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_erase_lost_profiles_in_links</span><span class="p">()</span>  <span class="c1"># remove lost foreign keys (because fk there are optional)</span>
        <span class="k">return</span> <span class="kc">True</span></div>

    <span class="k">def</span> <span class="nf">_erase_lost_profiles_in_links</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove all profile foreign keys in table Links that has no reference.</span>
<span class="sd">        This is mainly used to reset all lost foreign keys in table links after deleting a profile tha have been used</span>
<span class="sd">        in links.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get lost foreign keys from table Profile</span>
        <span class="n">lost_stuff</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;PRAGMA foreign_key_check(Links)&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="c1"># get rowid with parent == Profile (get lost foreign key from profile table)</span>
        <span class="n">lost_profile_ids</span> <span class="o">=</span> <span class="n">lost_stuff</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">lost_stuff</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Profile&#39;</span><span class="p">][</span><span class="s1">&#39;rowid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="c1"># set profile_id to null</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">lost_profile_ids</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;UPDATE Links SET Profile_id=NULL WHERE id=</span><span class="si">{id}</span><span class="s1">;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">idx</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<div class="viewcode-block" id="Database.contains_profile"><a class="viewcode-back" href="../../api.html#beamon.database.Database.contains_profile">[docs]</a>    <span class="k">def</span> <span class="nf">contains_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if profile with a specified index exists.</span>

<span class="sd">        :param index: profile index number</span>
<span class="sd">        :type index: integer</span>
<span class="sd">        :return: True/False</span>
<span class="sd">        :rtype: boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT id FROM Profile WHERE id=</span><span class="si">{id}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">index</span><span class="p">))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Database.get_loads_for_plotting"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_loads_for_plotting">[docs]</a>    <span class="k">def</span> <span class="nf">get_loads_for_plotting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Make a 9 column matrix containing (x,y,z,u,v,w, m_x,m_y,m_z) which are the positions and components of the</span>
<span class="sd">        forces applied to nodes of a specified model.</span>
<span class="sd">        This method is necessary for plotting the node loads accordingly.</span>

<span class="sd">        :return: numpy array with [x,y,z,u,v,w, m_x,m_y,m_z]/ None: if empty loads table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sd">&quot;&quot;&quot;SELECT n.x, n.y, n.z, f.x, f.y, f.z, f.m_x, f.m_y, f.m_z FROM Nodes n </span>
<span class="sd">                JOIN Load f ON n.id = f.node_id WHERE f.lineload_id is NULL and n.m_id={m_id}&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m_id</span><span class="o">=</span><span class="n">m_id</span><span class="p">))</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">results</span><span class="p">)</span></div>

<div class="viewcode-block" id="Database.get_loads"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_loads">[docs]</a>    <span class="k">def</span> <span class="nf">get_loads</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets all the nodes forces from Load table of a specified model.</span>
<span class="sd">        node_id are sub indices of nodes in the specified model.</span>

<span class="sd">        :param m_id: model number</span>
<span class="sd">        :type m_id: integer</span>
<span class="sd">        :return: following data columns: [id, node_id, x, y, z, m_x, m_y, m_z]</span>
<span class="sd">        :rtype: DataFrame</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">sql</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span>
            <span class="s2">&quot;SELECT l.id, subs.RowNum as node_id, l.x, l.y, l.z, l.m_x, l.m_y, l.m_z FROM Load l &quot;</span> <span class="o">+</span>
            <span class="sa">f</span><span class="s2">&quot;JOIN (SELECT id, row_number() OVER (ORDER BY id) RowNum FROM Nodes WHERE m_id = </span><span class="si">{</span><span class="n">m_id</span><span class="si">}</span><span class="s2">) subs on l.node_id = subs.id &quot;</span> <span class="o">+</span>
            <span class="sa">f</span><span class="s2">&quot;WHERE l.m_id = </span><span class="si">{</span><span class="n">m_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">con</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span></div>

<div class="viewcode-block" id="Database.get_loads_for_simulation"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_loads_for_simulation">[docs]</a>    <span class="k">def</span> <span class="nf">get_loads_for_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets all the nodes forces from Load table of a specified model.</span>
<span class="sd">        node_id are nodes sub indices in the specified model.</span>

<span class="sd">        :param m_id: model number</span>
<span class="sd">        :type m_id: integer</span>
<span class="sd">        :return: following data columns: [node_id, x, y, z, m_x, m_y, m_z]</span>
<span class="sd">        :rtype: DataFrame</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">sql</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span>
            <span class="s2">&quot;SELECT subs.RowNum as node_id, l.x, l.y, l.z, l.m_x, l.m_y, l.m_z FROM Load l &quot;</span> <span class="o">+</span>
            <span class="sa">f</span><span class="s2">&quot;JOIN (SELECT id, row_number() OVER (ORDER BY id) RowNum FROM Nodes WHERE m_id = </span><span class="si">{</span><span class="n">m_id</span><span class="si">}</span><span class="s2">) subs on l.node_id = subs.id &quot;</span> <span class="o">+</span>
            <span class="sa">f</span><span class="s2">&quot;WHERE l.m_id = </span><span class="si">{</span><span class="n">m_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">con</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span></div>

<div class="viewcode-block" id="Database.change_load"><a class="viewcode-back" href="../../api.html#beamon.database.Database.change_load">[docs]</a>    <span class="k">def</span> <span class="nf">change_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">m_x</span><span class="p">,</span> <span class="n">m_y</span><span class="p">,</span> <span class="n">m_z</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Change load information with specific index number.</span>
<span class="sd">        n_index is nodes sub index number</span>

<span class="sd">        :param index: load index to be changed</span>
<span class="sd">        :type index: integer</span>
<span class="sd">        :param n_index: node sub index number</span>
<span class="sd">        :type n_index: integer</span>
<span class="sd">        :param m_id: model number</span>
<span class="sd">        :type m_id: integer</span>
<span class="sd">        :param x: x-component</span>
<span class="sd">        :type x: float</span>
<span class="sd">        :param y: y-component</span>
<span class="sd">        :type y: float</span>
<span class="sd">        :param z: z-component</span>
<span class="sd">        :type z: float</span>
<span class="sd">        :param m_x: momentum in x-direction</span>
<span class="sd">        :type m_x: float</span>
<span class="sd">        :param m_y: momentum in y-direction</span>
<span class="sd">        :type m_y: float</span>
<span class="sd">        :param m_z: momentum in z-direction</span>
<span class="sd">        :type m_z: float</span>
<span class="sd">        :return: True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node_super_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_node_super_index</span><span class="p">(</span><span class="n">n_index</span><span class="p">,</span> <span class="n">m_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;UPDATE Load SET node_id=</span><span class="si">{n_index}</span><span class="s2">,x=</span><span class="si">{x}</span><span class="s2">,y=</span><span class="si">{y}</span><span class="s2">,z=</span><span class="si">{z}</span><span class="s2">,m_x=</span><span class="si">{m_x}</span><span class="s2">,m_y=</span><span class="si">{m_y}</span><span class="s2">,m_z=</span><span class="si">{m_z}</span><span class="s2"> WHERE id=</span><span class="si">{index}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">n_index</span><span class="o">=</span><span class="n">node_super_index</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">m_x</span><span class="o">=</span><span class="n">m_x</span><span class="p">,</span> <span class="n">m_y</span><span class="o">=</span><span class="n">m_y</span><span class="p">,</span> <span class="n">m_z</span><span class="o">=</span><span class="n">m_z</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT m_id FROM Load WHERE id=</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">m_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_change_model_last_modified</span><span class="p">(</span><span class="n">m_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Database.add_load"><a class="viewcode-back" href="../../api.html#beamon.database.Database.add_load">[docs]</a>    <span class="k">def</span> <span class="nf">add_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">m_x</span><span class="p">,</span> <span class="n">m_y</span><span class="p">,</span> <span class="n">m_z</span><span class="p">,</span> <span class="n">lineload_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;adds a load on the node specified with index and model number.</span>

<span class="sd">        :param index: node sub index number</span>
<span class="sd">        :type index: integer</span>
<span class="sd">        :param m_id: model number</span>
<span class="sd">        :type m_id: integer</span>
<span class="sd">        :param x: first component of the force vector</span>
<span class="sd">        :type x: float</span>
<span class="sd">        :param y: second component of the force vector</span>
<span class="sd">        :type y: float</span>
<span class="sd">        :param z: third component of the force vector</span>
<span class="sd">        :type z: float</span>
<span class="sd">        :param m_x: first component of the momentum vector</span>
<span class="sd">        :type m_x: float</span>
<span class="sd">        :param m_y: second component of the momentum vector</span>
<span class="sd">        :type m_y: float</span>
<span class="sd">        :param m_z: third component of the momentum vector</span>
<span class="sd">        :type m_z: float</span>
<span class="sd">        :param lineload_id: optional number of reference lineload</span>
<span class="sd">        :type lineload_id: integer</span>
<span class="sd">        :return: True: if successfully added or updated / False: if node doesnt exist</span>
<span class="sd">        :rtype: boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains_node</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">m_id</span><span class="o">=</span><span class="n">m_id</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">node_super_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_node_super_index</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">m_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lineload_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="s1">&#39;INSERT INTO Load (m_id, x, y, z, m_x, m_y, m_z, node_id, lineload_id) VALUES (</span><span class="si">{m_id}</span><span class="s1">, </span><span class="si">{x}</span><span class="s1">, </span><span class="si">{y}</span><span class="s1">, </span><span class="si">{z}</span><span class="s1">, </span><span class="si">{m_x}</span><span class="s1">, </span><span class="si">{m_y}</span><span class="s1">, </span><span class="si">{m_z}</span><span class="s1">, </span><span class="si">{index}</span><span class="s1">, NULL)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">m_id</span><span class="o">=</span><span class="n">m_id</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">m_x</span><span class="o">=</span><span class="n">m_x</span><span class="p">,</span> <span class="n">m_y</span><span class="o">=</span><span class="n">m_y</span><span class="p">,</span> <span class="n">m_z</span><span class="o">=</span><span class="n">m_z</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">node_super_index</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="s1">&#39;INSERT INTO Load (m_id, x, y, z, m_x, m_y, m_z, node_id, lineload_id) VALUES (</span><span class="si">{m_id}</span><span class="s1">, </span><span class="si">{x}</span><span class="s1">, </span><span class="si">{y}</span><span class="s1">, </span><span class="si">{z}</span><span class="s1">, </span><span class="si">{m_x}</span><span class="s1">, </span><span class="si">{m_y}</span><span class="s1">, </span><span class="si">{m_z}</span><span class="s1">, </span><span class="si">{index}</span><span class="s1">, </span><span class="si">{lineload_id}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">m_id</span><span class="o">=</span><span class="n">m_id</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">m_x</span><span class="o">=</span><span class="n">m_x</span><span class="p">,</span> <span class="n">m_y</span><span class="o">=</span><span class="n">m_y</span><span class="p">,</span> <span class="n">m_z</span><span class="o">=</span><span class="n">m_z</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">node_super_index</span><span class="p">,</span>
                    <span class="n">lineload_id</span><span class="o">=</span><span class="n">lineload_id</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

        <span class="c1"># get load index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT last_insert_rowid()&quot;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_change_model_last_modified</span><span class="p">(</span><span class="n">m_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>

        <span class="c1"># get the id of the last inserted row</span>
        <span class="c1"># self.cur.execute(&quot;&quot;&quot;SELECT lat_insert_rowid()&quot;&quot;&quot;)</span>
        <span class="c1"># id = self.cur.fetchall()[0]</span>

<div class="viewcode-block" id="Database.remove_load"><a class="viewcode-back" href="../../api.html#beamon.database.Database.remove_load">[docs]</a>    <span class="k">def</span> <span class="nf">remove_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove load with certain index number.</span>

<span class="sd">        :param index: load index.</span>
<span class="sd">        :type index: integer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT m_id FROM Load WHERE id=</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">m_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_change_model_last_modified</span><span class="p">(</span><span class="n">m_id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;DELETE FROM Load WHERE id=</span><span class="si">{index}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></div>

<div class="viewcode-block" id="Database.remove_loads_with_node"><a class="viewcode-back" href="../../api.html#beamon.database.Database.remove_loads_with_node">[docs]</a>    <span class="k">def</span> <span class="nf">remove_loads_with_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;remove all forces and moments in relation with the node.</span>

<span class="sd">        :param index: of the node</span>
<span class="sd">        :return: True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains_node</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;DELETE FROM Load WHERE node_id=</span><span class="si">{index}</span><span class="s1">;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Database.get_all_lineloads"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_all_lineloads">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_lineloads</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets all lineloads from Lineload table of a specified model.</span>

<span class="sd">        :return: [link_id, qx, qy, qz, qw]</span>
<span class="sd">        :rtype: float matrix</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">sql</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT id, link_id, qx, qy, qz, qw FROM Lineload WHERE m_id= </span><span class="si">{</span><span class="n">m_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">con</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span></div>

<div class="viewcode-block" id="Database.get_all_lineloads_for_simulation"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_all_lineloads_for_simulation">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_lineloads_for_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Gets all lineloads from Lineload table of a specified model.</span>
<span class="sd">        link_id are links sub index in the specified model.</span>

<span class="sd">        :param m_id: model number</span>
<span class="sd">        :type m_id: integer</span>
<span class="sd">        :return: following data columns: [link_id, qx, qy, qz, qw]</span>
<span class="sd">        :rtype: DataFrame</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">sql</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span>
            <span class="s2">&quot;SELECT subs.RowNum as link_id, l.qx, l.qy, l.qz, l.qw FROM Lineload l &quot;</span> <span class="o">+</span>
            <span class="sa">f</span><span class="s2">&quot;JOIN (SELECT id, row_number() OVER (ORDER BY id) RowNum FROM Links WHERE m_id = </span><span class="si">{</span><span class="n">m_id</span><span class="si">}</span><span class="s2">) subs on l.link_id = subs.id &quot;</span> <span class="o">+</span>
            <span class="sa">f</span><span class="s2">&quot;WHERE l.m_id = </span><span class="si">{</span><span class="n">m_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">con</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span></div>

<div class="viewcode-block" id="Database.change_lineload"><a class="viewcode-back" href="../../api.html#beamon.database.Database.change_lineload">[docs]</a>    <span class="k">def</span> <span class="nf">change_lineload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">l_index</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">qx</span><span class="p">,</span> <span class="n">qy</span><span class="p">,</span> <span class="n">qz</span><span class="p">,</span> <span class="n">qw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Change lineload data with specified lineload index.</span>

<span class="sd">        :param index: lineload index number</span>
<span class="sd">        :type index: integer</span>
<span class="sd">        :param l_index: link index number</span>
<span class="sd">        :type l_index: integer</span>
<span class="sd">        :param m_id: model number</span>
<span class="sd">        :type m_id: integer</span>
<span class="sd">        :param qx: constant force in x direction</span>
<span class="sd">        :type qx: float</span>
<span class="sd">        :param qy: constant force in y direction</span>
<span class="sd">        :type qy: float</span>
<span class="sd">        :param qz: constant force in z direction</span>
<span class="sd">        :type qz: float</span>
<span class="sd">        :param qw: constant momentum in x direction</span>
<span class="sd">        :type qw: float</span>
<span class="sd">        :return: True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">link_super_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_link_super_index</span><span class="p">(</span><span class="n">l_index</span><span class="p">,</span> <span class="n">m_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;UPDATE Lineload SET link_id=</span><span class="si">{l_index}</span><span class="s2">, qx=</span><span class="si">{qx}</span><span class="s2">,qy=</span><span class="si">{qy}</span><span class="s2">,qz=</span><span class="si">{qz}</span><span class="s2">,qw=</span><span class="si">{qw}</span><span class="s2"> WHERE id=</span><span class="si">{index}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">l_index</span><span class="o">=</span><span class="n">link_super_index</span><span class="p">,</span> <span class="n">qx</span><span class="o">=</span><span class="n">qx</span><span class="p">,</span> <span class="n">qy</span><span class="o">=</span><span class="n">qy</span><span class="p">,</span> <span class="n">qz</span><span class="o">=</span><span class="n">qz</span><span class="p">,</span> <span class="n">qw</span><span class="o">=</span><span class="n">qw</span>
            <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT m_id FROM Lineload WHERE id=</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">m_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_change_model_last_modified</span><span class="p">(</span><span class="n">m_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Database.add_lineload"><a class="viewcode-back" href="../../api.html#beamon.database.Database.add_lineload">[docs]</a>    <span class="k">def</span> <span class="nf">add_lineload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_id</span><span class="p">,</span> <span class="n">l_index</span><span class="p">,</span> <span class="n">qx</span><span class="p">,</span> <span class="n">qy</span><span class="p">,</span> <span class="n">qz</span><span class="p">,</span> <span class="n">qw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a lineload to a specified model.</span>

<span class="sd">        :param m_id: model number</span>
<span class="sd">        :type m_id: integer</span>
<span class="sd">        :param l_index: link index number</span>
<span class="sd">        :type l_index: integer</span>
<span class="sd">        :param qx: constant force in x direction</span>
<span class="sd">        :type qx: float</span>
<span class="sd">        :param qy: constant force in y direction</span>
<span class="sd">        :type qy: float</span>
<span class="sd">        :param qz: constant force in z direction</span>
<span class="sd">        :type qz: float</span>
<span class="sd">        :param qw: constant momentum in x direction</span>
<span class="sd">        :type qw: float</span>
<span class="sd">        :return: False/lineload index</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains_link</span><span class="p">(</span><span class="n">index1</span><span class="o">=</span><span class="n">l_index</span><span class="p">,</span> <span class="n">m_id</span><span class="o">=</span><span class="n">m_id</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;INSERT INTO Lineload (m_id, link_id, qx,qy,qz,qw) VALUES (</span><span class="si">{m_id}</span><span class="s2">, </span><span class="si">{l_index}</span><span class="s2">,</span><span class="si">{qx}</span><span class="s2">,</span><span class="si">{qy}</span><span class="s2">,</span><span class="si">{qz}</span><span class="s2">,</span><span class="si">{qw}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">m_id</span><span class="o">=</span><span class="n">m_id</span><span class="p">,</span> <span class="n">l_index</span><span class="o">=</span><span class="n">l_index</span><span class="p">,</span> <span class="n">qx</span><span class="o">=</span><span class="n">qx</span><span class="p">,</span> <span class="n">qy</span><span class="o">=</span><span class="n">qy</span><span class="p">,</span> <span class="n">qz</span><span class="o">=</span><span class="n">qz</span><span class="p">,</span> <span class="n">qw</span><span class="o">=</span><span class="n">qw</span>
            <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="c1"># get load index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT last_insert_rowid()&quot;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_change_model_last_modified</span><span class="p">(</span><span class="n">m_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Database.remove_lineload"><a class="viewcode-back" href="../../api.html#beamon.database.Database.remove_lineload">[docs]</a>    <span class="k">def</span> <span class="nf">remove_lineload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove a specified lineload.</span>

<span class="sd">        :param index: lineload index number</span>
<span class="sd">        :type index: integer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT m_id FROM Lineload WHERE id=</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">m_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_change_model_last_modified</span><span class="p">(</span><span class="n">m_id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DELETE FROM Lineload WHERE id=</span><span class="si">{index}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></div>

<div class="viewcode-block" id="Database.get_lineloads_for_plotting"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_lineloads_for_plotting">[docs]</a>    <span class="k">def</span> <span class="nf">get_lineloads_for_plotting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets lineloads index with starting and ending node coordinates</span>
<span class="sd">         and lineload forces from a specified model for plotting.</span>

<span class="sd">        :return: [link_id, x1,y1,z1,x2,y2,z2, qx,qy,qz,qw]</span>
<span class="sd">        :rtype: float matrix</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">sql</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span>
            <span class="s2">&quot;SELECT l.link_id id, n1.x x1, n1.y y1, n1.z z1, n2.x x2, n2.y y2, n2.z z2, l.qx, l.qy, l.qz, l.qw FROM&quot;</span> <span class="o">+</span>
            <span class="s2">&quot; Lineload l JOIN Links el ON l.link_id = el.id JOIN Nodes n1 ON el.n1_id = n1.id &quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;JOIN Nodes n2 ON el.n2_id = n2.id WHERE l.m_id= </span><span class="si">{</span><span class="n">m_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">con</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span></div>

<div class="viewcode-block" id="Database.import_text"><a class="viewcode-back" href="../../api.html#beamon.database.Database.import_text">[docs]</a>    <span class="k">def</span> <span class="nf">import_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">m_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Import geometry files to the database. If model number is given, geometry will be appended to the existing</span>
<span class="sd">        model. If model name was given geometry will be added to a new model.</span>
<span class="sd">        If model number is given and overwrite is True geometry in the specified model will be overwritten.</span>
<span class="sd">        View specified geometry syntax in documentation.</span>
<span class="sd">        Keywords: *node, *element, *profile, *load, *lineload, *joint</span>
<span class="sd">        Tables will be checked for integrity after import.</span>

<span class="sd">        :param path: of the text file to be imported</span>
<span class="sd">        :param m_id: model number</span>
<span class="sd">        :type m_id: integer</span>
<span class="sd">        :param m_name: model name</span>
<span class="sd">        :type m_name: string</span>
<span class="sd">        :param overwrite: overwrite geometry if valid model number was given</span>
<span class="sd">        :type overwrite: boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if no model information was given</span>
        <span class="k">if</span> <span class="n">m_id</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">m_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No model was specified&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">m_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">m_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Too many input parameters for model&quot;</span><span class="p">)</span>
        <span class="c1"># if file is inaccessible</span>
        <span class="k">if</span> <span class="nb">input</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">elif</span> <span class="n">m_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># check if model exists</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains_model</span><span class="p">(</span><span class="n">m_id</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No model found with id:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">m_id</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">m_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># check if model name has correct length</span>
            <span class="k">if</span> <span class="n">m_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">m_name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">MODEL_NAME_LENGTH</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="c1"># create new model</span>
            <span class="n">m_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">m_name</span><span class="p">)</span>
        <span class="c1"># check if file is text or binary</span>
        <span class="k">if</span> <span class="n">magic</span><span class="o">.</span><span class="n">from_buffer</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2048</span><span class="p">))</span> <span class="o">!=</span> <span class="s1">&#39;ASCII text, with CRLF line terminators&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;None ASCII text file with CRLF line terminators was given as input.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">overwrite</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">t_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Nodes&#39;</span><span class="p">,</span> <span class="s1">&#39;Links&#39;</span><span class="p">,</span> <span class="s1">&#39;Load&#39;</span><span class="p">,</span> <span class="s1">&#39;Lineload&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">clear_table</span><span class="p">(</span><span class="n">t_name</span><span class="p">,</span> <span class="n">m_id</span><span class="p">)</span>

        <span class="n">mode</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># reading status (node, element, etc.)</span>
        <span class="c1"># get max node id to append new nodes references</span>
        <span class="n">max_node_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_max_idx</span><span class="p">(</span><span class="s2">&quot;Nodes&quot;</span><span class="p">)</span>
        <span class="c1"># get max element id to append new element references</span>
        <span class="n">max_element_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_max_idx</span><span class="p">(</span><span class="s2">&quot;Links&quot;</span><span class="p">)</span>
        <span class="c1"># get max profile id</span>
        <span class="n">max_profile_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_max_idx</span><span class="p">(</span><span class="s2">&quot;Profile&quot;</span><span class="p">)</span>
        <span class="n">keywords</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;*node&quot;</span><span class="p">,</span> <span class="s2">&quot;*element&quot;</span><span class="p">,</span> <span class="s2">&quot;*profile&quot;</span><span class="p">,</span> <span class="s2">&quot;*load&quot;</span><span class="p">,</span> <span class="s2">&quot;*lineload&quot;</span><span class="p">,</span> <span class="s2">&quot;*joint&quot;</span><span class="p">]</span>  <span class="c1"># to be expected inside text file</span>
        <span class="c1"># create buffered csv files</span>
        <span class="c1"># nodes io writer</span>
        <span class="n">in_nodes</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">nodes_csv_writer</span> <span class="o">=</span> <span class="n">writer</span><span class="p">(</span><span class="n">in_nodes</span><span class="p">)</span>
        <span class="n">nodes_csv_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s1">&#39;m_id&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;u_x&#39;</span><span class="p">,</span> <span class="s1">&#39;u_y&#39;</span><span class="p">,</span> <span class="s1">&#39;u_z&#39;</span><span class="p">,</span> <span class="s1">&#39;phi_x&#39;</span><span class="p">,</span> <span class="s1">&#39;phi_y&#39;</span><span class="p">,</span> <span class="s1">&#39;phi_z&#39;</span><span class="p">])</span>
        <span class="c1"># elements io writer</span>
        <span class="n">in_links</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">links_csv_writer</span> <span class="o">=</span> <span class="n">writer</span><span class="p">(</span><span class="n">in_links</span><span class="p">)</span>
        <span class="n">links_csv_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s1">&#39;m_id&#39;</span><span class="p">,</span> <span class="s1">&#39;n1_id&#39;</span><span class="p">,</span> <span class="s1">&#39;n2_id&#39;</span><span class="p">,</span> <span class="s1">&#39;Profile_id&#39;</span><span class="p">,</span> <span class="s1">&#39;v_x&#39;</span><span class="p">,</span> <span class="s1">&#39;v_y&#39;</span><span class="p">,</span> <span class="s1">&#39;v_z&#39;</span><span class="p">])</span>
        <span class="c1"># profiles io writer</span>
        <span class="n">in_profiles</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">profiles_csv_writer</span> <span class="o">=</span> <span class="n">writer</span><span class="p">(</span><span class="n">in_profiles</span><span class="p">)</span>
        <span class="n">profiles_csv_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;Iy&#39;</span><span class="p">,</span> <span class="s1">&#39;Iz&#39;</span><span class="p">,</span> <span class="s1">&#39;kv&#39;</span><span class="p">])</span>
        <span class="c1"># loads io writer</span>
        <span class="n">in_loads</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">loads_csv_writer</span> <span class="o">=</span> <span class="n">writer</span><span class="p">(</span><span class="n">in_loads</span><span class="p">)</span>
        <span class="n">loads_csv_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s1">&#39;m_id&#39;</span><span class="p">,</span> <span class="s1">&#39;node_id&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;m_x&#39;</span><span class="p">,</span> <span class="s1">&#39;m_y&#39;</span><span class="p">,</span> <span class="s1">&#39;m_z&#39;</span><span class="p">])</span>
        <span class="c1"># lineloads io writer</span>
        <span class="n">in_lineloads</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">lineloads_csv_writer</span> <span class="o">=</span> <span class="n">writer</span><span class="p">(</span><span class="n">in_lineloads</span><span class="p">)</span>
        <span class="n">lineloads_csv_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s1">&#39;m_id&#39;</span><span class="p">,</span> <span class="s1">&#39;link_id&#39;</span><span class="p">,</span> <span class="s1">&#39;qx&#39;</span><span class="p">,</span> <span class="s1">&#39;qy&#39;</span><span class="p">,</span> <span class="s1">&#39;qz&#39;</span><span class="p">,</span> <span class="s1">&#39;qw&#39;</span><span class="p">])</span>
        <span class="c1"># joints io writer</span>
        <span class="n">in_joints</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">joints_csv_writer</span> <span class="o">=</span> <span class="n">writer</span><span class="p">(</span><span class="n">in_joints</span><span class="p">)</span>
        <span class="n">joints_csv_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s1">&#39;link_id&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="s1">&#39;6&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;7&#39;</span><span class="p">,</span> <span class="s1">&#39;8&#39;</span><span class="p">,</span> <span class="s1">&#39;9&#39;</span><span class="p">,</span> <span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;11&#39;</span><span class="p">,</span> <span class="s1">&#39;12&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">default_bc</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># default nodes boundry condition</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="c1"># strip commented characters inside the line</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;#.*&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>  <span class="c1"># regular expression for removing character after first &#39;#&#39;</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">):</span>  <span class="c1"># comment lines are still lines</span>
                        <span class="k">continue</span>

                    <span class="c1"># checking keywords</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">):</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keywords</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">mode</span> <span class="o">=</span> <span class="n">keywords</span><span class="p">[</span><span class="n">keywords</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="n">FileIntegrityError</span><span class="p">(</span><span class="s2">&quot;File mode changed unexpectedly on line &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
                            <span class="k">continue</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">FileIntegrityError</span><span class="p">(</span><span class="s2">&quot;False keyword at line &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>  <span class="c1"># empty line --&gt; reset keyword</span>
                        <span class="n">mode</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="k">continue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># reading input according to modes</span>
                        <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">FileIntegrityError</span><span class="p">(</span><span class="s2">&quot;No keyword selected for values at line &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
                        <span class="c1"># behave according ot chosen mode</span>
                        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;node&quot;</span><span class="p">:</span>
                            <span class="c1"># append to nodes</span>
                            <span class="n">values</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">numeric_string</span><span class="p">)</span> <span class="k">for</span> <span class="n">numeric_string</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>
                                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                                    <span class="k">raise</span> <span class="n">FileIntegrityError</span><span class="p">(</span><span class="s2">&quot;Missing values at line &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
                                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">:</span>
                                    <span class="k">raise</span> <span class="n">FileIntegrityError</span><span class="p">(</span><span class="s2">&quot;too many values at line &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
                                <span class="n">values</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                                    <span class="p">[</span><span class="n">default_bc</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">))])</span>  <span class="c1"># append missing dof values</span>
                                <span class="n">values</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">m_id</span><span class="p">)</span>
                                <span class="n">nodes_csv_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="n">FileIntegrityError</span><span class="p">(</span><span class="s2">&quot;No number value at line &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;element&#39;</span><span class="p">:</span>
                            <span class="c1"># append to links</span>
                            <span class="n">values_temp</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                            <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values_temp</span><span class="p">)):</span>
                                    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># profile id is optional argument</span>
                                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values_temp</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                            <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                                            <span class="k">continue</span>
                                        <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">values_temp</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">values_temp</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

                                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                                    <span class="k">raise</span> <span class="n">FileIntegrityError</span><span class="p">(</span><span class="s2">&quot;Missing values at line &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
                                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">:</span>
                                    <span class="k">raise</span> <span class="n">FileIntegrityError</span><span class="p">(</span><span class="s2">&quot;too many values at line &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>

                                <span class="c1"># appending nodes means shifting index</span>
                                <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">max_node_idx</span>
                                <span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">max_node_idx</span>

                                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                                    <span class="c1"># profile id if given should be integer value only</span>
                                    <span class="k">if</span> <span class="ow">not</span> <span class="n">values</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                        <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                                            <span class="k">raise</span> <span class="n">FileIntegrityError</span><span class="p">(</span><span class="s2">&quot;Wrong profile index given at line &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
                                        <span class="n">values</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="n">max_profile_idx</span>

                                <span class="c1"># append missing values</span>
                                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                                    <span class="n">values</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                                    <span class="n">values</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                                    <span class="n">values</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                                    <span class="n">values</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
                                <span class="n">values</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">m_id</span><span class="p">)</span>
                                <span class="n">links_csv_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="n">FileIntegrityError</span><span class="p">(</span><span class="s2">&quot;No integer or float value at line &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;profile&quot;</span><span class="p">:</span>
                            <span class="c1"># append to profile</span>
                            <span class="n">values</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="c1"># append missing values to row</span>
                                <span class="n">missing_values</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">missing_values</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                    <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_append_missing_values</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">missing_values</span><span class="p">)</span>
                                <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cast_to_float</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>  <span class="c1"># try to convert to number value</span>
                                <span class="n">profiles_csv_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="n">FileIntegrityError</span><span class="p">(</span><span class="s2">&quot;No number value at line &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;load&quot;</span><span class="p">:</span>
                            <span class="c1"># append to Loads</span>
                            <span class="n">values</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="c1"># append missing values to row</span>
                                <span class="n">missing_values</span> <span class="o">=</span> <span class="mi">7</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">missing_values</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                    <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_append_missing_values</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">missing_values</span><span class="p">)</span>
                                <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cast_to_float</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>  <span class="c1"># try to convert to number value</span>

                                <span class="c1"># appending loads means shifting nodes index</span>
                                <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">max_node_idx</span>

                                <span class="n">values</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">m_id</span><span class="p">)</span>
                                <span class="n">loads_csv_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="n">FileIntegrityError</span><span class="p">(</span><span class="s2">&quot;No number value at line &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;lineload&quot;</span><span class="p">:</span>
                            <span class="c1"># append to Lineloads</span>
                            <span class="n">values</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="c1"># append missing values to row</span>
                                <span class="n">missing_values</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">missing_values</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                    <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_append_missing_values</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">missing_values</span><span class="p">)</span>
                                <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cast_to_float</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>  <span class="c1"># try to convert to number value</span>

                                <span class="c1"># appending loads means shifting elements index</span>
                                <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">max_element_idx</span>

                                <span class="n">values</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">m_id</span><span class="p">)</span>
                                <span class="n">lineloads_csv_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="n">FileIntegrityError</span><span class="p">(</span><span class="s2">&quot;No number value at line &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;joint&quot;</span><span class="p">:</span>
                            <span class="c1"># append to edof</span>
                            <span class="n">in_values</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">in_values</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="n">FileIntegrityError</span><span class="p">(</span><span class="s2">&quot;Missing input elements at line &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
                            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">in_values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="n">FileIntegrityError</span><span class="p">(</span><span class="s2">&quot;Too many input elements at line &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
                                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">in_values</span><span class="p">):</span>
                                    <span class="c1"># try to convert to integer number value</span>
                                    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">in_values</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="p">:</span>
                                        <span class="k">raise</span> <span class="n">FileIntegrityError</span><span class="p">(</span><span class="s2">&quot;Too many dof numbers at line &quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
                                    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                        <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">+</span> <span class="n">max_element_idx</span><span class="p">)</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="k">for</span> <span class="n">dof</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                                            <span class="n">v</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dof</span><span class="p">)</span>
                                            <span class="k">if</span> <span class="n">v</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="mi">7</span><span class="p">:</span>
                                                <span class="k">raise</span> <span class="n">FileIntegrityError</span><span class="p">(</span><span class="s2">&quot;Incorrect dof number at line &quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
                                            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                                                <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span> <span class="o">+</span> <span class="mi">6</span><span class="p">)</span>
                                            <span class="k">else</span><span class="p">:</span>
                                                <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="n">FileIntegrityError</span><span class="p">(</span><span class="s2">&quot;No number value at line &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
                                <span class="k">raise</span> <span class="n">FileIntegrityError</span><span class="p">(</span><span class="s2">&quot;Duplicate dof numbers at line &quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
                            <span class="n">joints_csv_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;File not Found: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>

        <span class="c1"># go back to the start of the StringIO</span>
        <span class="n">in_nodes</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">in_links</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">in_profiles</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">in_loads</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">in_lineloads</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">in_joints</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Create a trigger in case the modifications on the database fail</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_trigger</span><span class="p">([</span><span class="s2">&quot;Nodes&quot;</span><span class="p">,</span> <span class="s2">&quot;Links&quot;</span><span class="p">,</span> <span class="s2">&quot;Load&quot;</span><span class="p">,</span> <span class="s2">&quot;Lineload&quot;</span><span class="p">],</span> <span class="n">m_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_trigger</span><span class="p">([</span><span class="s2">&quot;Profile&quot;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_data_to_sql</span><span class="p">(</span><span class="n">m_id</span><span class="p">,</span> <span class="n">in_nodes</span><span class="p">,</span> <span class="s2">&quot;Nodes&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_to_sql</span><span class="p">(</span><span class="n">m_id</span><span class="p">,</span> <span class="n">in_links</span><span class="p">,</span> <span class="s2">&quot;Links&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_to_sql</span><span class="p">(</span><span class="n">m_id</span><span class="p">,</span> <span class="n">in_profiles</span><span class="p">,</span> <span class="s2">&quot;Profile&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_to_sql</span><span class="p">(</span><span class="n">m_id</span><span class="p">,</span> <span class="n">in_loads</span><span class="p">,</span> <span class="s2">&quot;Load&quot;</span><span class="p">,</span> <span class="n">insert_nan_col</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">nan_col_name</span><span class="o">=</span><span class="s2">&quot;lineload_id&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_to_sql</span><span class="p">(</span><span class="n">m_id</span><span class="p">,</span> <span class="n">in_lineloads</span><span class="p">,</span> <span class="s2">&quot;Lineload&quot;</span><span class="p">)</span>

        <span class="c1"># check databases foreign keys</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;PRAGMA foreign_key_check;&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="c1"># no errors occurred</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># revert changes according to triggers and abort</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_revert_changes</span><span class="p">(</span><span class="n">m_id</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">FileIntegrityError</span><span class="p">(</span>
                <span class="s2">&quot;Integrity check failed: Missing or wrong references. Check if id numbers are correct&quot;</span><span class="p">)</span>
        <span class="c1"># builds static edof numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_edof</span><span class="p">(</span><span class="n">m_id</span><span class="p">)</span>
        <span class="c1"># insert joints</span>
        <span class="n">static_edof</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_edof</span><span class="p">(</span><span class="n">m_id</span><span class="p">)</span>
        <span class="c1"># import the buffered csv file containing joints data as a DataFrame</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">in_joints</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># check for duplicate links in joints</span>
        <span class="k">if</span> <span class="n">temp</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="s1">&#39;link_id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">FileIntegrityError</span><span class="p">(</span><span class="s2">&quot;Duplicate element id in joints&quot;</span><span class="p">)</span>
        <span class="c1"># replace free dof with zeros</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">temp</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">edof</span> <span class="o">=</span> <span class="n">static_edof</span><span class="p">[</span><span class="n">static_edof</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">edof</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">change_edof</span><span class="p">(</span><span class="n">edof</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">e_index</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_change_model_last_modified</span><span class="p">(</span><span class="n">m_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>

    <span class="k">def</span> <span class="nf">_data_to_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">StringIO</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">insert_nan_col</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">nan_col_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Transform IO String to pandas table and insert pandas table in database</span>

<span class="sd">        :param m_id: model number</span>
<span class="sd">        :type m_id: integer</span>
<span class="sd">        :param data: Buffered CSV file</span>
<span class="sd">        :type data: StringIO</span>
<span class="sd">        :param name: Table name to be inserted. Options (Nodes, Elements, Profile, Load, Lineload)</span>
<span class="sd">        :type name: string</span>
<span class="sd">        :param insert_nan_col: insert a column with Null values</span>
<span class="sd">        :type insert_nan_col: boolean</span>
<span class="sd">        :param nan_col_name: column name to be inserted</span>
<span class="sd">        :type nan_col_name: string</span>
<span class="sd">        :param overwrite: overwrite original data in table</span>
<span class="sd">        :type overwrite: boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># import the csv file into a dataframe</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">insert_nan_col</span> <span class="ow">and</span> <span class="n">nan_col_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nan_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">temp</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">nan_vec</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="n">temp</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nan_col_name</span><span class="p">,</span> <span class="n">nan_vec</span><span class="p">)</span>

        <span class="c1"># add primary key column</span>
        <span class="k">if</span> <span class="n">overwrite</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_table</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">m_id</span><span class="p">)</span>
        <span class="c1"># column starts with last primary key + 1</span>
        <span class="n">p_key_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_max_idx</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">temp</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">p_key_count</span><span class="p">,</span> <span class="n">p_key_count</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp</span><span class="p">)))</span>
        <span class="c1"># insert data into the database without changing the table, hence if_exists=&quot;append&quot;</span>
        <span class="n">temp</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_trigger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t_list</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">t_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">m_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">triggers</span><span class="p">[</span><span class="n">table</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2"> WHERE m_id= </span><span class="si">{</span><span class="n">m_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                                                   <span class="n">con</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># if table has no m_id column</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">triggers</span><span class="p">[</span><span class="n">table</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">con</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_revert_changes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">triggers</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">t_name</span><span class="p">,</span> <span class="n">table</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">triggers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_table</span><span class="p">(</span><span class="n">t_name</span><span class="p">,</span> <span class="n">m_id</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="n">t_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_append_missing_values</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
            <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">values</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_cast_to_float</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
            <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">temp</span>

    <span class="k">def</span> <span class="nf">get_max_idx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT max(id) FROM </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<div class="viewcode-block" id="Database.export_text"><a class="viewcode-back" href="../../api.html#beamon.database.Database.export_text">[docs]</a>    <span class="k">def</span> <span class="nf">export_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Exports geometry of a specified model to text file</span>

<span class="sd">        :param path: the path including the File name to be saved (ex. filename.csv)</span>
<span class="sd">        :param m_id: model number</span>
<span class="sd">        :type m_id: integer</span>
<span class="sd">        :return: True if saved, False if not saved</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains_model</span><span class="p">(</span><span class="n">m_id</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">nodes_table</span> <span class="o">=</span> <span class="n">sql</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT id, x,y,z,u_x,u_y,u_z,phi_x,phi_y,phi_z FROM Nodes WHERE m_id= </span><span class="si">{</span><span class="n">m_id</span><span class="si">}</span><span class="s2">;&quot;</span><span class="p">,</span>
                                   <span class="n">con</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="n">links_table</span> <span class="o">=</span> <span class="n">sql</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT id, n1_id, n2_id, Profile_id, v_x, v_y, v_z FROM Links WHERE m_id= </span><span class="si">{</span><span class="n">m_id</span><span class="si">}</span><span class="s2">;&quot;</span><span class="p">,</span>
                                   <span class="n">con</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="n">profiles_table</span> <span class="o">=</span> <span class="n">sql</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="s2">&quot;SELECT E, G, A, Iy, Iz, kv  FROM Profile&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="n">loads_table</span> <span class="o">=</span> <span class="n">sql</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;SELECT node_id, x, y, z, m_x, m_y, m_z FROM Load WHERE lineload_id is NULL and m_id= </span><span class="si">{</span><span class="n">m_id</span><span class="si">}</span><span class="s2">;&quot;</span><span class="p">,</span>
            <span class="n">con</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="n">lineloads_table</span> <span class="o">=</span> <span class="n">sql</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT link_id, qx, qy, qz, qw FROM lineload WHERE m_id= </span><span class="si">{</span><span class="n">m_id</span><span class="si">}</span><span class="s2">;&quot;</span><span class="p">,</span>
                                       <span class="n">con</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="n">joints_table</span> <span class="o">=</span> <span class="n">sql</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;SELECT id, ux1,uy1,uz1,phix1,phiy1,phiz1,ux2,uy2,uz2,phix2,phiy2,phiz2 FROM Links WHERE m_id= </span><span class="si">{</span><span class="n">m_id</span><span class="si">}</span><span class="s2"> and &quot;</span> <span class="o">+</span>
            <span class="s2">&quot; (ux1=0 or uy1=0 or uz1=0 or phix1=0 or phiy1=0 or phiz1=0 or ux2=0 or uy2=0 or uz2=0 or phix2=0 or phiy2=0 or phiz2=0)&quot;</span><span class="p">,</span>
            <span class="n">con</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="c1"># shift index back to 1</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">links_table</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">links_table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes_table</span><span class="p">[</span><span class="n">nodes_table</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">links_table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes_table</span><span class="p">[</span><span class="n">nodes_table</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">loads_table</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">loads_table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes_table</span><span class="p">[</span><span class="n">nodes_table</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">lineloads_table</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">lineloads_table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">links_table</span><span class="p">[</span><span class="n">links_table</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="c1"># remove id columns from Nodes and Links</span>
        <span class="n">nodes_table</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
        <span class="n">links_table</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>

        <span class="n">m_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">m_id</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# Beamon geometry | model &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">m_name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;*node</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">nodes_table</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path_or_buf</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">float_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">*element</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">links_table</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path_or_buf</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">float_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">*load</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">loads_table</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path_or_buf</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">float_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">*lineload</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">lineloads_table</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path_or_buf</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">float_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">*joint</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">joints_table</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">is_set</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">joints_table</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">col</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">joints_table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">joints_table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">col</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_set</span><span class="p">:</span>
                            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">col</span> <span class="o">-</span> <span class="mi">6</span><span class="p">))</span>
                            <span class="n">is_set</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">col</span> <span class="o">-</span> <span class="mi">6</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="p">))</span>
            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out</span><span class="p">))</span>

        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">*profile</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">profiles_table</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path_or_buf</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">float_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Database.backup"><a class="viewcode-back" href="../../api.html#beamon.database.Database.backup">[docs]</a>    <span class="k">def</span> <span class="nf">backup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">destination_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates Backup to Database with specified path</span>

<span class="sd">        :param destination_path: Backup database path</span>
<span class="sd">        :type destination_path: string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dest</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">destination_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">backup</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span>
        <span class="n">dest</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="Database.is_settings_preset"><a class="viewcode-back" href="../../api.html#beamon.database.Database.is_settings_preset">[docs]</a>    <span class="k">def</span> <span class="nf">is_settings_preset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks if settings table has already been changed or not.</span>

<span class="sd">        :return: True / False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT id FROM VisualizerSettings&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Database.get_grid_settings"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_grid_settings">[docs]</a>    <span class="k">def</span> <span class="nf">get_grid_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets latest grid settings from table VisualizerSettings.</span>

<span class="sd">        :return: list of params / None if table is empty</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span>
            <span class="s2">&quot;SELECT grid_x1origin,grid_x2origin, grid_x3origin, grid_n1, grid_n2, grid_n3, grid_xtick, grid_ytick from VisualizerSettings&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>  <span class="c1"># use ORDER BY id DESC LIMIT 10</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;grid_x1origin&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;grid_x2origin&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;grid_x3origin&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                  <span class="n">df</span><span class="p">[</span><span class="s1">&#39;grid_n1&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;grid_n2&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;grid_n3&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                  <span class="n">df</span><span class="p">[</span><span class="s1">&#39;grid_xtick&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;grid_ytick&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">params</span></div>

<div class="viewcode-block" id="Database.set_grid_settings"><a class="viewcode-back" href="../../api.html#beamon.database.Database.set_grid_settings">[docs]</a>    <span class="k">def</span> <span class="nf">set_grid_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets all grid settings to the table VisualizerSettings.</span>

<span class="sd">        :param params: (grid_x1origin,grid_x2origin, grid_x3origin, grid_n1, grid_n2, grid_n3, grid_xtick, grid_ytick)</span>
<span class="sd">        :type params: doubles list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check if settings are set</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_settings_preset</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="s2">&quot;INSERT INTO VisualizerSettings (grid_x1origin,grid_x2origin, grid_x3origin, grid_n1, grid_n2, grid_n3, grid_xtick, grid_ytick) VALUES (?,?,?,?,?,?,?,?)&quot;</span><span class="p">,</span>
                <span class="n">params</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="s2">&quot;UPDATE VisualizerSettings SET grid_x1origin=?,grid_x2origin=?, grid_x3origin=?, grid_n1=?, grid_n2=?, grid_n3=?, grid_xtick=?, grid_ytick=? WHERE id=1&quot;</span><span class="p">,</span>
                <span class="n">params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></div>

<div class="viewcode-block" id="Database.get_view_settings"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_view_settings">[docs]</a>    <span class="k">def</span> <span class="nf">get_view_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get all view settings from table VisualizerSettings.</span>

<span class="sd">        :return: list of params / None if table is empty</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span>
            <span class="s2">&quot;SELECT view_dim, show_labels, show_local_systems, show_bc, show_node_loads, show_line_loads, show_color_bar from VisualizerSettings&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>  <span class="c1"># use ORDER BY id DESC LIMIT 10</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;view_dim&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;show_labels&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;show_local_systems&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;show_bc&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                  <span class="n">df</span><span class="p">[</span><span class="s1">&#39;show_node_loads&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;show_line_loads&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;show_color_bar&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">params</span></div>

<div class="viewcode-block" id="Database.set_view_settings"><a class="viewcode-back" href="../../api.html#beamon.database.Database.set_view_settings">[docs]</a>    <span class="k">def</span> <span class="nf">set_view_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets all view settings to the table VisualizerSettings.</span>

<span class="sd">        :param params: list with 1 numbers following order (view_dim)</span>
<span class="sd">        :type params: doubles list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check if settings are set</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_settings_preset</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="s2">&quot;INSERT INTO VisualizerSettings (view_dim, show_labels, show_local_systems, show_bc,show_node_loads, show_line_loads, show_color_bar) VALUES (?, ?, ?,?,?, ?, ?)&quot;</span><span class="p">,</span>
                <span class="p">[</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="mi">6</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="s2">&quot;UPDATE VisualizerSettings SET view_dim=?, show_labels=?, show_local_systems=?, show_bc=?,show_node_loads=?, show_line_loads=?, show_color_bar=? WHERE id=1 &quot;</span><span class="p">,</span>
                <span class="p">[</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="mi">6</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></div>

<div class="viewcode-block" id="Database.get_results_view_settings"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_results_view_settings">[docs]</a>    <span class="k">def</span> <span class="nf">get_results_view_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get all results view settings from table VisualizerSettings.</span>

<span class="sd">        :return: results view map</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span>
            <span class="s2">&quot;SELECT disp_nodes, disp_elements, nodes_sup_forces_trans, nodes_sup_forces_mom, elements_section_forces,&quot;</span>
            <span class="o">+</span> <span class="s2">&quot; displacements_scale from VisualizerSettings&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>  <span class="c1"># use ORDER BY id DESC LIMIT 10</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span> <span class="ow">or</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;disp_nodes&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">results_view_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;disp nodes&#39;</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;disp_nodes&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
            <span class="s1">&#39;disp elements&#39;</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;disp_elements&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
            <span class="s1">&#39;nodes sup forces trans&#39;</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;nodes_sup_forces_trans&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
            <span class="s1">&#39;nodes sup forces mom&#39;</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;nodes_sup_forces_mom&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
            <span class="s1">&#39;elements section forces&#39;</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;elements_section_forces&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
            <span class="s1">&#39;displacements scale&#39;</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;displacements_scale&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">results_view_map</span></div>

<div class="viewcode-block" id="Database.set_results_view_settings"><a class="viewcode-back" href="../../api.html#beamon.database.Database.set_results_view_settings">[docs]</a>    <span class="k">def</span> <span class="nf">set_results_view_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapping</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets all results view settings to the table VisualizerSettings</span>

<span class="sd">        :param mapping: dictionary to map each parameter</span>
<span class="sd">        :type mapping: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check if settings are set</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_settings_preset</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="s2">&quot;INSERT INTO VisualizerSettings (disp_nodes, disp_elements, nodes_sup_forces_trans, nodes_sup_forces_mom, elements_section_forces, displacements_scale) VALUES (?, ?, ?, ?, ?, ?)&quot;</span><span class="p">,</span>
                <span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="s1">&#39;disp nodes&#39;</span><span class="p">],</span> <span class="n">mapping</span><span class="p">[</span><span class="s1">&#39;disp elements&#39;</span><span class="p">],</span> <span class="n">mapping</span><span class="p">[</span><span class="s1">&#39;nodes sup forces trans&#39;</span><span class="p">],</span>
                 <span class="n">mapping</span><span class="p">[</span><span class="s1">&#39;nodes sup forces mom&#39;</span><span class="p">],</span>
                 <span class="n">mapping</span><span class="p">[</span><span class="s1">&#39;elements section forces&#39;</span><span class="p">],</span> <span class="n">mapping</span><span class="p">[</span><span class="s1">&#39;displacements scale&#39;</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="s2">&quot;UPDATE VisualizerSettings SET disp_nodes=?, disp_elements=?, nodes_sup_forces_trans=?, nodes_sup_forces_mom=?, elements_section_forces=?, displacements_scale=? WHERE id=1 &quot;</span><span class="p">,</span>
                <span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="s1">&#39;disp nodes&#39;</span><span class="p">],</span> <span class="n">mapping</span><span class="p">[</span><span class="s1">&#39;disp elements&#39;</span><span class="p">],</span> <span class="n">mapping</span><span class="p">[</span><span class="s1">&#39;nodes sup forces trans&#39;</span><span class="p">],</span>
                 <span class="n">mapping</span><span class="p">[</span><span class="s1">&#39;nodes sup forces mom&#39;</span><span class="p">],</span>
                 <span class="n">mapping</span><span class="p">[</span><span class="s1">&#39;elements section forces&#39;</span><span class="p">],</span> <span class="n">mapping</span><span class="p">[</span><span class="s1">&#39;displacements scale&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></div>

<div class="viewcode-block" id="Database.get_lost_dependencies"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_lost_dependencies">[docs]</a>    <span class="k">def</span> <span class="nf">get_lost_dependencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This method gets nodes indexes from Links and node loads that are not connected anymore.</span>
<span class="sd">        Warning: Using this method means you could have lost data and generated a delete anomaly in the database</span>
<span class="sd">        TODO: use this method in integrity check</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># m1: nodes ids in links</span>
        <span class="c1"># m2: nodes ids</span>
        <span class="c1"># Algebra expression:</span>
        <span class="c1"># (m1 U m2) \ m1</span>
        <span class="c1"># for further explanation see Documentation</span>
        <span class="n">lost_links_left</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;SELECT n1_id id From Links EXCEPT SELECT id FROM Nodes&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="n">lost_links_right</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;SELECT n2_id id From Links EXCEPT SELECT id FROM Nodes&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="c1"># outer join exclusion</span>
        <span class="n">lost_links</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">lost_links_left</span><span class="p">,</span> <span class="n">lost_links_right</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
        <span class="c1"># Loads</span>
        <span class="n">lost_loads</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;SELECT node_id id From Load EXCEPT SELECT id FROM Nodes&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lost_links</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="n">lost_loads</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span></div>

<div class="viewcode-block" id="Database.clear_database"><a class="viewcode-back" href="../../api.html#beamon.database.Database.clear_database">[docs]</a>    <span class="k">def</span> <span class="nf">clear_database</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete/erase all the data from the database tables of a specified model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DELETE FROM LineLoad WHERE m_id=</span><span class="si">{m_id}</span><span class="s2">;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m_id</span><span class="o">=</span><span class="n">m_id</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DELETE FROM Links WHERE m_id=</span><span class="si">{m_id}</span><span class="s2">;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m_id</span><span class="o">=</span><span class="n">m_id</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DELETE FROM Load WHERE m_id=</span><span class="si">{m_id}</span><span class="s2">;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m_id</span><span class="o">=</span><span class="n">m_id</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DELETE FROM Lineload WHERE m_id=</span><span class="si">{m_id}</span><span class="s2">;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m_id</span><span class="o">=</span><span class="n">m_id</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DELETE FROM Nodes WHERE m_id=</span><span class="si">{m_id}</span><span class="s2">;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m_id</span><span class="o">=</span><span class="n">m_id</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DELETE FROM Profile;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;DELETE FROM &quot;VisualizerSettings&quot;;&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">clear_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_column</span><span class="p">(</span><span class="n">t_name</span><span class="p">,</span> <span class="s2">&quot;m_id&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DELETE FROM </span><span class="si">{</span><span class="n">t_name</span><span class="si">}</span><span class="s2"> WHERE m_id = </span><span class="si">{</span><span class="n">m_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DELETE FROM </span><span class="si">{</span><span class="n">t_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_has_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">col_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT </span><span class="si">{</span><span class="n">col_name</span><span class="si">}</span><span class="s2"> FROM </span><span class="si">{</span><span class="n">t_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># has no column</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<div class="viewcode-block" id="Database.get_edof"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_edof">[docs]</a>    <span class="k">def</span> <span class="nf">get_edof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets all links indices and degrees of freedom from links of a specified model.</span>

<span class="sd">        :return: [id, ux1,uy1,uz1,phix1,phiy1,phiz1,ux2,uy2,uz2,phix2,phiy2,phiz2]</span>
<span class="sd">        :rtype: integer matrix</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">edof</span> <span class="o">=</span> <span class="n">sql</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;SELECT id, ux1,uy1,uz1,phix1,phiy1,phiz1,ux2,uy2,uz2,phix2,phiy2,phiz2 FROM Links WHERE m_id= </span><span class="si">{</span><span class="n">m_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">con</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">edof</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">edof</span></div>

<div class="viewcode-block" id="Database.get_edof_for_simulation"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_edof_for_simulation">[docs]</a>    <span class="k">def</span> <span class="nf">get_edof_for_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets all links starting and ending nodes indices with degrees of freedom from links of a specified model.</span>

<span class="sd">        :return: [n1_id, n2_id, ux1,uy1,uz1,phix1,phiy1,phiz1,ux2,uy2,uz2,phix2,phiy2,phiz2]</span>
<span class="sd">        :rtype: integer matrix</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;SELECT n1_id, n2_id, ux1,uy1,uz1,phix1,phiy1,phiz1,ux2,uy2,uz2,phix2,phiy2,phiz2 FROM Links WHERE m_id=</span><span class="si">{m_id}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">m_id</span><span class="o">=</span><span class="n">m_id</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span></div>

<div class="viewcode-block" id="Database.change_edof"><a class="viewcode-back" href="../../api.html#beamon.database.Database.change_edof">[docs]</a>    <span class="k">def</span> <span class="nf">change_edof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edof</span><span class="p">,</span> <span class="n">n_index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">e_index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Changes given degrees of freedom for all elements connected to the node with n_index.</span>
<span class="sd">        If e_index is given instead, only the degrees of freedom for that element will be changed.</span>

<span class="sd">        :param n_index: index of the node | integer</span>
<span class="sd">        :param edof: list of integers [ux1, uy1, uz1, phix1, ... , uz2, phix2, phiy2, phiz2]</span>
<span class="sd">        :param e_index: index of the element | integer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">e_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains_link</span><span class="p">(</span><span class="n">e_index</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="s1">&#39;UPDATE Links SET ux1=</span><span class="si">{ux1}</span><span class="s1">,uy1=</span><span class="si">{uy1}</span><span class="s1"> ,uz1=</span><span class="si">{uz1}</span><span class="s1"> ,phix1=</span><span class="si">{phix1}</span><span class="s1">,phiy1=</span><span class="si">{phiy1}</span><span class="s1">,phiz1=</span><span class="si">{phiz1}</span><span class="s1"> WHERE id=</span><span class="si">{eid}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">eid</span><span class="o">=</span><span class="n">e_index</span><span class="p">,</span> <span class="n">ux1</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">uy1</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">uz1</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">phix1</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">phiy1</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
                    <span class="n">phiz1</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                <span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="s1">&#39;UPDATE Links SET ux2=</span><span class="si">{ux2}</span><span class="s1">,uy2=</span><span class="si">{uy2}</span><span class="s1"> ,uz2=</span><span class="si">{uz2}</span><span class="s1"> ,phix2=</span><span class="si">{phix2}</span><span class="s1">,phiy2=</span><span class="si">{phiy2}</span><span class="s1">,phiz2=</span><span class="si">{phiz2}</span><span class="s1"> WHERE id=</span><span class="si">{eid}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">eid</span><span class="o">=</span><span class="n">e_index</span><span class="p">,</span> <span class="n">ux2</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">uy2</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">uz2</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">phix2</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">phiy2</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span>
                    <span class="n">phiz2</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span>
                <span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT m_id FROM Links WHERE id=</span><span class="si">{</span><span class="n">e_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">m_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_change_model_last_modified</span><span class="p">(</span><span class="n">m_id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="s1">&#39;UPDATE Links SET ux1=</span><span class="si">{ux1}</span><span class="s1">,uy1=</span><span class="si">{uy1}</span><span class="s1"> ,uz1=</span><span class="si">{uz1}</span><span class="s1"> ,phix1=</span><span class="si">{phix1}</span><span class="s1">,phiy1=</span><span class="si">{phiy1}</span><span class="s1">,phiz1=</span><span class="si">{phiz1}</span><span class="s1"> WHERE n1_id=</span><span class="si">{id}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">id</span><span class="o">=</span><span class="n">n_index</span><span class="p">,</span> <span class="n">ux1</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">uy1</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">uz1</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">phix1</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">phiy1</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">phiz1</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                <span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="s1">&#39;UPDATE Links SET ux2=</span><span class="si">{ux2}</span><span class="s1">,uy2=</span><span class="si">{uy2}</span><span class="s1"> ,uz2=</span><span class="si">{uz2}</span><span class="s1"> ,phix2=</span><span class="si">{phix2}</span><span class="s1">,phiy2=</span><span class="si">{phiy2}</span><span class="s1">,phiz2=</span><span class="si">{phiz2}</span><span class="s1"> WHERE n2_id=</span><span class="si">{id}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">id</span><span class="o">=</span><span class="n">n_index</span><span class="p">,</span> <span class="n">ux2</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">uy2</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">uz2</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">phix2</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">phiy2</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">phiz2</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span>
                <span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT m_id FROM Nodes WHERE id=</span><span class="si">{</span><span class="n">n_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">m_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_change_model_last_modified</span><span class="p">(</span><span class="n">m_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Database.make_edof"><a class="viewcode-back" href="../../api.html#beamon.database.Database.make_edof">[docs]</a>    <span class="k">def</span> <span class="nf">make_edof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create element degrees of freedom numbers for a specified model</span>
<span class="sd">        This method is used when static topology is initiated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_links</span><span class="p">(</span><span class="n">m_id</span><span class="p">):</span>
            <span class="k">return</span>  <span class="c1"># abort</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_all_links</span><span class="p">(</span><span class="n">m_id</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">change_edof</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_default_static_edof</span><span class="p">(</span><span class="n">link</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">link</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">m_id</span><span class="p">),</span> <span class="n">e_index</span><span class="o">=</span><span class="n">link</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="Database.get_default_edof"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_default_edof">[docs]</a>    <span class="k">def</span> <span class="nf">get_default_edof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets default element degrees of freedom numbers for a specific link in a specified model</span>

<span class="sd">        :param index: link index number</span>
<span class="sd">        :type index: integer</span>
<span class="sd">        :param m_id: model number</span>
<span class="sd">        :type m_id: integer</span>
<span class="sd">        :return: 1 x 12 array</span>
<span class="sd">        :rtype: integer array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s1">&#39;SELECT n1_id, n2_id, ux1,uy1,uz1,phix1,phiy1,phiz1,ux2,uy2,uz2,phix2,phiy2,phiz2 FROM Links WHERE id=</span><span class="si">{id}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">id</span><span class="o">=</span><span class="n">index</span><span class="p">))</span>
        <span class="n">link</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">zeros_indexes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">link</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">n1_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_node_sub_index</span><span class="p">(</span><span class="n">link</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m_id</span><span class="p">)</span>
        <span class="n">n2_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_node_sub_index</span><span class="p">(</span><span class="n">link</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">m_id</span><span class="p">)</span>

        <span class="n">start_dof</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n1_id</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span> <span class="n">n1_id</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">end_dof</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n2_id</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span> <span class="n">n2_id</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">default_edof</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">start_dof</span><span class="p">,</span> <span class="n">end_dof</span><span class="p">))</span>
        <span class="n">default_edof</span><span class="p">[</span><span class="n">zeros_indexes</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="n">default_edof</span></div>

<div class="viewcode-block" id="Database.get_static_edof"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_static_edof">[docs]</a>    <span class="k">def</span> <span class="nf">get_static_edof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets edof matrix for all elements from a specified model.</span>

<span class="sd">        :param m_id: model number</span>
<span class="sd">        :type m_id: integer</span>
<span class="sd">        :return: n x 12 integer matrix</span>
<span class="sd">        :rtype: integer[][]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">links</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_all_links</span><span class="p">(</span><span class="n">m_id</span><span class="p">)</span>
        <span class="n">static_edof</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">links</span><span class="p">:</span>
            <span class="n">default_edof</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_default_static_edof</span><span class="p">(</span><span class="n">link</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">link</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">m_id</span><span class="p">))</span>
            <span class="n">static_edof</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">static_edof</span><span class="p">,</span> <span class="n">default_edof</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">static_edof</span></div>

<div class="viewcode-block" id="Database.get_default_static_edof"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_default_static_edof">[docs]</a>    <span class="k">def</span> <span class="nf">get_default_static_edof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">id1</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">id2</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">m_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the default element degrees of freedom for a specific element defined with starting and</span>
<span class="sd">        ending node indices of a specified model. Default means that all degrees of freedom are locked</span>
<span class="sd">        (stiff connections).</span>

<span class="sd">        :param id1: index of starting node</span>
<span class="sd">        :param id2: index of ending node</span>
<span class="sd">        :param m_id: model number</span>
<span class="sd">        :type m_id: integer</span>
<span class="sd">        :return: integer list [ux1, uy1, uz1, phix1, ... , uz2, phix2, phiy2, phiz2]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_links</span><span class="p">(</span><span class="n">m_id</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>
        <span class="n">n1_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_node_sub_index</span><span class="p">(</span><span class="n">id1</span><span class="p">,</span> <span class="n">m_id</span><span class="p">)</span>
        <span class="n">n2_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_node_sub_index</span><span class="p">(</span><span class="n">id2</span><span class="p">,</span> <span class="n">m_id</span><span class="p">)</span>
        <span class="n">start_dof</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n1_id</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span> <span class="n">n1_id</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">end_dof</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n2_id</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span> <span class="n">n2_id</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">start_dof</span><span class="p">,</span> <span class="n">end_dof</span><span class="p">))</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span></div>

<div class="viewcode-block" id="Database.get_joints"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_joints">[docs]</a>    <span class="k">def</span> <span class="nf">get_joints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get joints locations for a specified model.</span>
<span class="sd">        Those are nodes coordinates + v. v is the direction of links from joints.</span>

<span class="sd">        :return: [x,y,z]</span>
<span class="sd">        :rtype: float array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get links coordinates which have free dof numbers</span>
        <span class="c1"># links starting nodes joints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sd">&quot;&quot;&quot;SELECT n2.x - n1.x x, n2.y - n1.y y, n2.z - n1.z z, n1.x nx, n1.y ny, n1.z nz FROM Links l </span>
<span class="sd">            JOIN Nodes n1 ON l.n1_id = n1.id </span>
<span class="sd">            JOIN Nodes n2 ON l.n2_id = n2.id </span>
<span class="sd">            WHERE (l.ux1=0 OR l.uy1=0 OR l.uz1=0 OR l.phix1=0 OR l.phiy1=0 OR l.phiz1=0) and l.m_id={m_id}&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">m_id</span><span class="o">=</span><span class="n">m_id</span><span class="p">))</span>
        <span class="n">first_joints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span>
        <span class="c1"># links ending nodes joints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sd">&quot;&quot;&quot;SELECT n1.x - n2.x x, n1.y - n2.y y, n1.z - n2.z z, n2.x nx, n2.y ny, n2.z nz FROM Links l </span>
<span class="sd">            JOIN Nodes n1 ON l.n1_id = n1.id </span>
<span class="sd">            JOIN Nodes n2 ON l.n2_id = n2.id </span>
<span class="sd">            WHERE (l.ux2=0 OR l.uy2=0 OR l.uz2=0 OR l.phix2=0 OR l.phiy2=0 OR l.phiz2=0) and l.m_id={m_id}&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">m_id</span><span class="o">=</span><span class="n">m_id</span><span class="p">))</span>
        <span class="n">second_joints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span>
        <span class="n">joints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="c1"># joints only at the end of links</span>
        <span class="k">if</span> <span class="n">first_joints</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">joints</span> <span class="o">=</span> <span class="n">second_joints</span>
        <span class="c1"># joints only at the beginning of links</span>
        <span class="k">if</span> <span class="n">second_joints</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">joints</span> <span class="o">=</span> <span class="n">first_joints</span>
        <span class="c1"># joints at beginning at end of links</span>
        <span class="k">if</span> <span class="n">first_joints</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">second_joints</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">joints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">first_joints</span><span class="p">,</span> <span class="n">second_joints</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">joints</span><span class="p">)):</span>
            <span class="c1"># (x,y,z) + 0.005 * v</span>
            <span class="n">joints</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">joints</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">:]</span> <span class="o">+</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="p">(</span><span class="n">joints</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">])</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">joints</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">joints</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">joints</span>
        <span class="k">return</span> <span class="n">joints</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="nf">_get_all_links</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_id</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;SELECT id, n1_id, n2_id, ux1,uy1,uz1,phix1,phiy1,phiz1,ux2,uy2,uz2,phix2,phiy2,phiz2 FROM Links WHERE m_id=</span><span class="si">{m_id}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">m_id</span><span class="o">=</span><span class="n">m_id</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../index.html">
    <img class="logo" src="../../_static/sla-logo2.png" alt="Logo"/>
    
  </a>
</p>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../making_a_model.html">Making A Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../theory.html">Theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contrib.html">Contributing</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Maher Albezem.
      
    </div>

    

    
  </body>
</html>